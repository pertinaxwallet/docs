"use strict";(self.webpackChunkeverscale_docs_website=self.webpackChunkeverscale_docs_website||[]).push([[2194],{3905:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return u}});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},p=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,l=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),h=d(a),u=o,k=h["".concat(s,".").concat(u)]||h[u]||c[u]||l;return a?n.createElement(k,r(r({ref:t},p),{},{components:a})):n.createElement(k,r({ref:t},p))}));function u(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var l=a.length,r=new Array(l);r[0]=h;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,r[1]=i;for(var d=2;d<l;d++)r[d]=a[d];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},4930:function(e,t,a){a.r(t),a.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return i},metadata:function(){return d},toc:function(){return c}});var n=a(3117),o=a(102),l=(a(7294),a(3905)),r=["components"],i={sidebar_position:0},s="Getting started",d={unversionedId:"validate/depools/getting-started",id:"validate/depools/getting-started",title:"Getting started",description:"This document contains instructions on how to deploy and configure a DePool smart contract, and run a validator node through it.",source:"@site/../../src/validate/depools/getting-started.md",sourceDirName:"validate/depools",slug:"/validate/depools/getting-started",permalink:"/validate/depools/getting-started",draft:!1,editUrl:"https://github.com/everscale-org/docs/edit/main/.build/website/../../src/validate/depools/getting-started.md",tags:[],version:"current",lastUpdatedAt:1658794573,formattedLastUpdatedAt:"Jul 26, 2022",sidebarPosition:0,frontMatter:{sidebar_position:0},sidebar:"tutorialSidebar",previous:{title:"DePools",permalink:"/validate/depools"},next:{title:"FAQ",permalink:"/validate/depools/faq"}},p={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Procedure",id:"procedure",level:2},{value:"1. Set Up Node and Deploy Validator Wallet",id:"1-set-up-node-and-deploy-validator-wallet",level:3},{value:"3. Generate Deployment Keys",id:"3-generate-deployment-keys",level:3},{value:"4. Calculate Contract Addresses",id:"4-calculate-contract-addresses",level:3},{value:"4.1. Calculate DePool address",id:"41-calculate-depool-address",level:4},{value:"4.2. (Optional) Calculate DePool Helper address",id:"42-optional-calculate-depool-helper-address",level:4},{value:"5. Send Coins to the Calculated Addresses",id:"5-send-coins-to-the-calculated-addresses",level:3},{value:"6.1. Deploy DePool contract to the basechain",id:"61-deploy-depool-contract-to-the-basechain",level:4},{value:"6.2. (Optional) Deploy DePool Helper contract to the basechain",id:"62-optional-deploy-depool-helper-contract-to-the-basechain",level:4},{value:"7. Configure DePool State Update method",id:"7-configure-depool-state-update-method",level:3},{value:"State update through Multisig Contract",id:"state-update-through-multisig-contract",level:4},{value:"State update through DePool Helper contract (temporarily unavailable)",id:"state-update-through-depool-helper-contract-temporarily-unavailable",level:4},{value:"State update through external call of the DePool Helper Contract",id:"state-update-through-external-call-of-the-depool-helper-contract",level:4},{value:"8. Make Stakes",id:"8-make-stakes",level:3},{value:"DePool fees",id:"depool-fees",level:5},{value:"Configure TONOS-CLI for DePool operations",id:"configure-tonos-cli-for-depool-operations",level:4},{value:"Deposit stakes",id:"deposit-stakes",level:4},{value:"1) Ordinary stake",id:"1-ordinary-stake",level:5},{value:"2) Vesting stake",id:"2-vesting-stake",level:5},{value:"Transfer stakes",id:"transfer-stakes",level:4},{value:"Withdraw Stakes",id:"withdraw-stakes",level:4},{value:"1) Withdraw entire stake",id:"1-withdraw-entire-stake",level:5},{value:"2) Withdraw part of the stake",id:"2-withdraw-part-of-the-stake",level:5},{value:"Reinvest Stakes",id:"reinvest-stakes",level:4},{value:"9. Check  Donors and Stakes in the DePool",id:"9-check--donors-and-stakes-in-the-depool",level:3},{value:"10. Set Up Validator Script",id:"10-set-up-validator-script",level:3},{value:"For C++ node",id:"for-c-node",level:4},{value:"For Rust Node",id:"for-rust-node",level:4},{value:"11. Maintain Positive Balance on DePool and Supplementary Contracts",id:"11-maintain-positive-balance-on-depool-and-supplementary-contracts",level:3},{value:"DePool Balance",id:"depool-balance",level:4},{value:"Proxy Balance",id:"proxy-balance",level:4},{value:"Withdrawing excess funds",id:"withdrawing-excess-funds",level:5},{value:"DePool Helper Balance",id:"depool-helper-balance",level:4},{value:"Validator Wallet Balance",id:"validator-wallet-balance",level:4},{value:"12. Check DePool Status in the Elections",id:"12-check-depool-status-in-the-elections",level:3},{value:"On ever.live",id:"on-everlive",level:4},{value:"Using DePool Events",id:"using-depool-events",level:4},{value:"Using get-methods",id:"using-get-methods",level:4},{value:"<code>getParticipantInfo(address addr)</code>",id:"getparticipantinfoaddress-addr",level:5},{value:"<code>getDePoolInfo()</code>",id:"getdepoolinfo",level:5},{value:"<code>getRounds()</code>",id:"getrounds",level:5},{value:"<code>getParticipants()</code>",id:"getparticipants",level:4},{value:"<code>getDePoolBalance()</code>",id:"getdepoolbalance",level:4},{value:"13. (Optional) Adjust validator and participant reward fraction",id:"13-optional-adjust-validator-and-participant-reward-fraction",level:3},{value:"14. (Optional) Close DePool",id:"14-optional-close-depool",level:3},{value:"Rewards Distribution",id:"rewards-distribution",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"1. Wrong contract version",id:"1-wrong-contract-version",level:3},{value:"2. DePool isn&#39;t emitting events",id:"2-depool-isnt-emitting-events",level:3},{value:"3. Validator script and election request issues",id:"3-validator-script-and-election-request-issues",level:3},{value:"For C++ Node",id:"for-c-node-1",level:4},{value:"For Rust Node",id:"for-rust-node-1",level:4},{value:"4. DePool function terminates with error in TONOS-CLI",id:"4-depool-function-terminates-with-error-in-tonos-cli",level:3}],h={toc:c};function u(e){var t=e.components,a=(0,o.Z)(e,r);return(0,l.kt)("wrapper",(0,n.Z)({},h,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"getting-started"},"Getting started"),(0,l.kt)("p",null,"This document contains instructions on how to deploy and configure a DePool smart contract, and run a validator node through it."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"EverX DePools repository ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/tonlabs/ton-labs-contracts/tree/master/solidity/depool"},"https://github.com/tonlabs/ton-labs-contracts/tree/master/solidity/depool"))),(0,l.kt)("p",null,"It is intended for the latest version of the DePool contract. For instructions on the archive versions of DePool refer to the relevant ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/tonlabs/ton-labs-contracts/releases"},"tags")," in the repository. Note that they are intended for reference only and should not be used on the network anymore."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"Note"),": For RustCup use the DePool from ",(0,l.kt)("inlineCode",{parentName:"p"},"RUSTCUP_DEPOOL_--_DO_NOT_DEPLOY_ON_MAINNET")," branch. ",(0,l.kt)("strong",{parentName:"p"},"Do not use it on any other network"),".\nFor detailed information on DePool specifications, please refer to the ",(0,l.kt)("a",{parentName:"p",href:"/learn/decentralization/depool-specifications"},"relevant document"),".")),(0,l.kt)("p",null,"Answers to frequently asked questions can be found ",(0,l.kt)("a",{parentName:"p",href:"/validate/depools/faq"},"here"),"."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"Note"),": One node can be assigned to only one DePool contract.\n",(0,l.kt)("strong",{parentName:"p"},"Note"),": Validator contest winners are strongly recommended not to deploy DePool to the main net without previously testing their setup out on the devnet for a few days. Test tokens for staking on the devnet can be requested from community admins.")),(0,l.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/tonlabs/tonos-cli"},"TONOS-CLI")," of the latest version (0.3.0 or later) installed and configured."),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/tonlabs/TVM-linker"},"tvm_linker")," utility."),(0,l.kt)("p",null,"Resources required to run a node available:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.ton.dev/86757ecb2/v/0/p/708260-run-validator/t/2177a7"},"For C++ node")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/tonlabs/rustnet.ton.dev#1-system-requirements"},"For Rust node"))),(0,l.kt)("h2",{id:"procedure"},"Procedure"),(0,l.kt)("p",null,"To function correctly, the DePool contract requires an active validator node and a set of supporting smart contracts, that have to be deployed and configured alongside it:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"The Validator Wallet, which should be a ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/tonlabs/ton-labs-contracts/tree/master/solidity/safemultisig"},"multisignature wallet")," with at least three custodians and ",(0,l.kt)("inlineCode",{parentName:"li"},"reqConfirms")," > 1. ",(0,l.kt)("strong",{parentName:"li"},"Can be deployed to the basechain"),"."),(0,l.kt)("li",{parentName:"ol"},"The DePool contract itself, ",(0,l.kt)("strong",{parentName:"li"},"deployed to the basechain"),". DePool contract deploys two proxy smart contracts to the masterchain, which will pass messages from the DePool to the Elector smart contract. Two proxies are required to support two staking rounds running in parallel, one for odd rounds, and one for even rounds."),(0,l.kt)("li",{parentName:"ol"},"Optionally, the DePool Helper contract, which is connected to the global Timer contract and ensures regular operation of the DePool. Also ",(0,l.kt)("strong",{parentName:"li"},"deployed to the basechain.")," Can be replaced with ",(0,l.kt)("a",{parentName:"li",href:"#7-configure-depool-state-update-method"},"other methods")," of updating DePool state.")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"Important: the only contracts requiring masterchain in this setup are the two proxy contracts, ",(0,l.kt)("strong",{parentName:"p"},"which are deployed by DePool"),". Everything else is designed to function on the basechain, as the contracts are rather complex and consume a lot of gas.\nOnce all of these contracts are deployed and configured, the DePool is ready to receive stakes.")),(0,l.kt)("p",null,"Follow the steps described below to complete this procedure."),(0,l.kt)("h3",{id:"1-set-up-node-and-deploy-validator-wallet"},"1. Set Up Node and Deploy Validator Wallet"),(0,l.kt)("p",null,"When using DePool you may set up the validator wallet ",(0,l.kt)("strong",{parentName:"p"},"on the basechain"),", as the DePool itself operates on the basechain and will pass your stakes to the masterchain Elector contract through its proxy contracts."),(0,l.kt)("p",null,"With that in mind, follow:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"For C++ node -  ",(0,l.kt)("a",{parentName:"li",href:"https://docs.ton.dev/86757ecb2/v/0/p/708260-run-validator"},"this procedure")," up to step 4.4 (the validator script in step 5 will be ",(0,l.kt)("a",{parentName:"li",href:"#10-set-up-validator-script"},"different"),") "),(0,l.kt)("li",{parentName:"ul"},"For Rust node - ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/tonlabs/rustnet.ton.dev"},"this procedure")," up to step 6")),(0,l.kt)("p",null,"and make sure to set up at least three custodians for your wallet."),(0,l.kt)("p",null,"Make sure that in the course of the procedure:"),(0,l.kt)("p",null,"For C++ node:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"validator wallet address was specified in the ",(0,l.kt)("inlineCode",{parentName:"li"},"~/ton-keys/$(hostname -s).addr")," file."),(0,l.kt)("li",{parentName:"ul"},"validator wallet keys were saved to the ",(0,l.kt)("inlineCode",{parentName:"li"},"~/ton-keys/msig.keys.json")," file.")),(0,l.kt)("p",null,"For Rust node:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"validator wallet address was specified in the ",(0,l.kt)("inlineCode",{parentName:"li"},"/ton-node/configs/${VALIDATOR_NAME}.addr")," file."),(0,l.kt)("li",{parentName:"ul"},"validator wallet keys were saved to the ",(0,l.kt)("inlineCode",{parentName:"li"},"/ton-node/configs/keys/msig.keys.json")," file.")),(0,l.kt)("p",null,"The wallet address will also be needed on the following steps."),(0,l.kt)("p",null,"As always, also make sure to securely backup all of your seed phrases and/or wallet keys, generated during wallet and node setup. If you lose them, you will not be able to recover access to your funds."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"Note:  The validator wallet should have a small sum of tokens available at all times to reliably send election requests to DePool. Each election request costs ~ 1 Ton."),(0,l.kt)("h3",{parentName:"blockquote",id:"2-prepare-depool-and-supporting-smart-contracts"},"2. Prepare DePool and Supporting Smart Contracts")),(0,l.kt)("p",null,"Obtain contract code from the ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/tonlabs/ton-labs-contracts/tree/master/solidity/depool"},"repository"),"."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"Note"),": For RustCup use the DePool from ",(0,l.kt)("inlineCode",{parentName:"p"},"RUSTCUP_DEPOOL_--_DO_NOT_DEPLOY_ON_MAINNET")," branch. ",(0,l.kt)("strong",{parentName:"p"},"Do not use it on any other network."),"\nThe files required for DePool deployment are comprised of three pairs of compiled contract .tvc files and their corresponding ABI files:")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"DePoolProxy.tvc")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"DePool.tvc")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"DePool.abi.json")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"DePoolHelper.tvc")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"DePoolHelper.abi.json")),(0,l.kt)("h3",{id:"3-generate-deployment-keys"},"3. Generate Deployment Keys"),(0,l.kt)("p",null,"Use TONOS-CLI to generate seed phrases for the contracts you will be deploying:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli genphrase\n")),(0,l.kt)("p",null,"Do not reuse wallet keys, or any other keys you may have used elsewhere already."),(0,l.kt)("p",null,"Securely backup these seed phrases and keep them secret, as without them, control over the DePool contract will be lost (for example, without its key, the DePool cannot be closed). If you suspect that your keys are compromised, close the DePool and deploy it anew with new keys and a new set of supporting contracts."),(0,l.kt)("p",null,"Generate key pair files from the seed phrases (this step is intended for the sake of convenience as nothing in the seed phrases indicates for what contract they are intended, and they are easy to mix up)."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli getkeypair depool.json "seed_phrase_for_depool"\ntonos-cli getkeypair helper.json "seed_phrase_for_helper"\n')),(0,l.kt)("h3",{id:"4-calculate-contract-addresses"},"4. Calculate Contract Addresses"),(0,l.kt)("p",null,"The smart contracts you will be deploying need to be configured to know the addresses of each other. Thus, first you have to calculate and save the addresses of every contract to be deployed."),(0,l.kt)("h4",{id:"41-calculate-depool-address"},"4.1. Calculate DePool address"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli genaddr DePool.tvc DePool.abi.json --setkey depool.json --wc 0\n")),(0,l.kt)("p",null,"Save the DePool address."),(0,l.kt)("p",null,"Put it into the following files in in your validator node setup:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"~/ton-keys/depool.addr")," file - for C++ Node "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"/ton-node/configs/depool.addr")," - for Rust Node")),(0,l.kt)("p",null,"It will be required for the ",(0,l.kt)("a",{parentName:"p",href:"#10-set-up-validator-script"},"validator script"),"."),(0,l.kt)("h4",{id:"42-optional-calculate-depool-helper-address"},"4.2. (Optional) Calculate DePool Helper address"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli genaddr DePoolHelper.tvc DePoolHelper.abi.json --setkey helper.json --wc 0\n")),(0,l.kt)("p",null,"Save the DePool Helper address."),(0,l.kt)("h3",{id:"5-send-coins-to-the-calculated-addresses"},"5. Send Coins to the Calculated Addresses"),(0,l.kt)("p",null,"Send some coins to all addresses calculated on step 4 to initialize them with the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli call <wallet_address> submitTransaction \'{"dest":"contract_address","value":*number*,"bounce":"false","allBalance":"false","payload":""}\' --abi <MultisigWallet.abi.json> --sign <wallet_seed_or_keyfile>\n')),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<wallet_address>")," - is the address of the wallet, from which you are making the transaction"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<contract_address>")," - address of one of the contracts, calculated on step 4."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},'"value":*number*')," - the amount of coins to be transferred (in nanotokens)."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},'"bounce":"false"')," - bounce flag set to false, to allow a transaction to an account that is not yet initialized."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<MultisigWallet.abi.json>")," - the ABI file of the contract, from which you are making the transaction (for validator wallets - usually ",(0,l.kt)("inlineCode",{parentName:"p"},"SafeMultisigWallet.abi.json"),")"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<wallet_seed_or_keyfile>")," - either the seed phrase in double quotes, or the path to the keyfile for the wallet, from which you are making the transaction"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"allBalance")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"payload")," values in this case remain default."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli call 0:2bb4a0e8391e7ea8877f4825064924bd41ce110fce97e939d3323999e1efbb13 submitTransaction \'{"dest":"0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace","value":200000000,"bounce":"false","allBalance":"false","payload":""}\' --abi ./SafeMultisigWallet.abi.json --sign ./wallet.json\n')),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://github.com/tonlabs/ton-labs-contracts/tree/master/solidity/safemultisig#47-create-transaction-confirmation-online"},"Confirm the transaction"),", if it is required."),(0,l.kt)("p",null,"Such a transaction should be repeated for every address calculated on step 4: the DePool contract itself and, optionally, the DePool Helper contract."),(0,l.kt)("p",null,"The recommended initial amounts are:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"21 Evers to the DePool conrtact"),(0,l.kt)("li",{parentName:"ul"},"5 Evers to the DePool Helper"),(0,l.kt)("li",{parentName:"ul"},"10 Evers should be left on the validator wallet")),(0,l.kt)("p",null,"For the duration of the DePool existence, balance on all DePool-related contracts should be maintained:"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("a",{parentName:"p",href:"#proxy-balance"},"Proxies")," receive fees for their services automatically, but if they run out of funds for any reason, DePool might miss elections.\n",(0,l.kt)("a",{parentName:"p",href:"#depool-helper-balance"},"Helper"),", on the other hand, should be topped up regularly, depending on the set timer period. Without funds on the Helper contract, DePool will not be able to function regularly.\nThe ",(0,l.kt)("a",{parentName:"p",href:"#depool-balance"},"DePool")," itself receives funds for its operations from validation rewards, but may also, if it stops receiving these rewards, run out of funds."),(0,l.kt)("h3",{parentName:"blockquote",id:"6-deploy-contracts"},"6. Deploy Contracts")),(0,l.kt)("h4",{id:"61-deploy-depool-contract-to-the-basechain"},"6.1. Deploy DePool contract to the basechain"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli deploy DePool.tvc \'{"minStake":*number*,"validatorAssurance":*number*,"proxyCode":"<ProxyContractCodeInBase64>","validatorWallet":"<validatorWalletAddress>","participantRewardFraction":*number*}\' --abi DePool.abi.json --sign depool.json --wc 0\n')),(0,l.kt)("p",null," Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},'"minStake":*number*')," \u2013 minimum stake (in nanoevers) that DePool accepts from participants. It's recommended to set it not less than 10 tokens."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},'"validatorAssurance":*number*')," - minimal stake for validator. If validator has stake less than ",(0,l.kt)("strong",{parentName:"p"},"validatorAssurance"),", DePool won't be taking part in elections."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"ProxyContractCodeInBase64")," - code of the proxy contract. Can be obtained by calling ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/tonlabs/TVM-linker"},"tvm_linker"),": "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tvm_linker decode --tvc DePoolProxy.tvc\n")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<validatorWalletAddress>")," \u2013 validator wallet address from step 1."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},'"participantRewardFraction":*number*')," - percentage of the total DePool reward (in integers, up to 99 inclusive) that goes to Participants. It's recommended to set it at 95% or more."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"Important: You will not be able to change all of these parameters, except ",(0,l.kt)("inlineCode",{parentName:"strong"},"participantRewardFraction"),", after the DePool is deployed. They will influence the appeal of your DePool to potential participants:"),"\n",(0,l.kt)("inlineCode",{parentName:"p"},"participantRewardFraction")," determines what percentage of their total reward all participants will receive (too small, and other DePools might draw them away, too big, and your validator wallet might not receive enough rewards, to support validation and staking); it can be adjusted at any time by the DePool owner, but only upwards - see how ",(0,l.kt)("a",{parentName:"p",href:"#13-optional-adjust-validator-and-participant-reward-fraction"},"below"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"validatorAssurance")," determines how much you take it upon yourself to invest in the DePool and lose in case of any validator node malfunction or misbehavior. If set too small, potential participants might decide you aren't risking enough and avoid your DePool in favor of others.\nExample:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli deploy DePool.tvc \'{"minStake":10000000000,"validatorAssurance":100000000000000,"proxyCode":"te6ccgECIgEABdIAAib/APSkICLAAZL0oOGK7VNYMPShBwEBCvSkIPShAgIDzkAGAwIB1AUEADk7UTQ0//TP9MA0wf6QPhs+Gv4an/4Yfhm+GP4YoAA9PhCyMv/+EPPCz/4Rs8LAPhK+Ev4TF4gywfOzsntVIADTu/CC3SXgE7zRTfjAQaY/pn5mQwQh/////XUcjuDRTfbBKtFN/MBjvwQgCrqVAUNq//CW4ZGfCwGUAOeegZwD9AUaCIAAAAAAAAAAAAAAAAACHtMu6Z4sQ54Wf/CTni2S4/YBvL4HJeARvQIBIBAIAgFuDwkCASAOCgIBIA0LAZj6f40IYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABPhpIe1E0CDXScIBjhnT/9M/0wDTB/pA+Gz4a/hqf/hh+Gb4Y/hiDAG4joDi0wABn4ECANcYIPkBWPhC+RDyqN7TPwGOHvhDIbkgnzAg+COBA+iogggbd0Cgud6S+GPggDTyNNjTHyHBAyKCEP////28sZZbcfAB8AXgAfAB+EdukzDwBd4WALu0t7mSfCC3SXgE72mf6Lg0U32wSrRTfzAY78EIAq6lQFDav/wluGRnwsBlADnnoGcA/QFGgiAAAAAAAAAAAAAAAAAB8+0HGmeLEOeFn/wk54tkuP2AGEl4BG8//DPAAMe23RITPhBbpLwCd7TP9Mf0XBopvtglWim/mAx34IQBV1KgKG1f/hLcMjPhYDKAHPPQM4B+gKNBEAAAAAAAAAAAAAAAAABM+vBdM8WIs8LPyHPCx/4Sc8WyXH7AFuS8Ajef/hngAMe5zeipnwgt0l4BO9pn+mP6Lg0U32wSrRTfzAY78EIAq6lQFDav/wluGRnwsBlADnnoGcA/QFGgiAAAAAAAAAAAAAAAAABO2QLJmeLEWeFn5DnhY/8JOeLZLj9gC3JeARvP/wzwAgEgGxECASAYEgEPuotV8/+EFugTATKOgN74RvJzcfhm0fhJ+EvHBfLgZvAIf/hnFAFG7UTQINdJwgGOGdP/0z/TANMH+kD4bPhr+Gp/+GH4Zvhj+GIVAQaOgOIWAf70BXEhgED0DpPXCweRcOL4anIhgED0Do4kjQhgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE3/hrcyGAQPQOjiSNCGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATf+GxwAYBA9A7yvdcL//hicPhjFwAMcPhmf/hhAgFqGhkA8bTYWbL8ILdJeATvaZ/9IGj8JPwl44L5cDN8E7eIODRTfbBKtFN/MBjvwQgdzWUAUFq/33lwM7g0U32wSrRTfzAY78EIAq6lQFDav5DkZ8LEZwD9AUaCIAAAAAAAAAAAAAAAAAEdldCSZ4sRZ4Wf5Lj9gC34BD/8M8AApbQlaov8ILdJeATvaPwk/CZjgvlwNHwTt4gQOUEIHc1lAFRan99HERA5QQgdzWUAVFqf0Nq/kHwmZGfChGcA/QFANeegZLh9gBhvGEl4BG8//DPAAgEgHRwAn7rbxCnvhBbpLwCd7R+EuCEDuaygAiwP+OLSTQ0wH6QDAxyM+HIM6NBAAAAAAAAAAAAAAAAArbxCnozxYizxYhzws/yXH7AN5bkvAI3n/4Z4AgEgIR4BCbhxdZGQHwH6+EFukvAJ3tM/0//TH9Mf1w3/ldTR0NP/3yDXS8ABAcAAsJPU0dDe1PpBldTR0PpA39H4SfhLxwXy4Gb4J28QcGim+2CVaKb+YDHfghA7msoAoLV/vvLgZ3BopvtglWim/mAx34IQBV1KgKG1fyHIz4WIzgH6AoBqz0DPg8ggAFLPkTnN0S4ozws/J88L/ybPCx8lzwsfJM8L/yPPFM3JcfsAXwfwCH/4ZwCC3HAi0NMD+kAw+GmpOADcIccAIJwwIdMfIcAAIJJsId7f3CHBAyKCEP////28sZZbcfAB8AXgAfAB+EdukzDwBd4=","validatorWallet":"0:0123012301230123012301230123012301230123012301230123012301230123","participantRewardFraction":95}\' --abi DePool.abi.json --sign depool.json --wc 0\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"Note"),": For RustCup, make sure to get the proxy code from the contract file in the ",(0,l.kt)("inlineCode",{parentName:"p"},"RUSTCUP_DEPOOL_--_DO_NOT_DEPLOY_ON_MAINNET")," branch. ",(0,l.kt)("strong",{parentName:"p"},"Do not use it on any other network"),".\nAt the time of deployment, the variable ",(0,l.kt)("inlineCode",{parentName:"p"},"m_balanceThreshold")," is set as current DePool account balance - 5 tokens. DePool will replenish its balance from validation rewards to this value every round it receives rewards.")),(0,l.kt)("h4",{id:"62-optional-deploy-depool-helper-contract-to-the-basechain"},"6.2. (Optional) Deploy DePool Helper contract to the basechain"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli deploy DePoolHelper.tvc \'{"pool":"DePoolAddress"}\' --abi DePoolHelper.abi.json --sign helper.json --wc 0\n')),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<DePoolAddress>")," \u2013 address ",(0,l.kt)("strong",{parentName:"p"},"of the DePool contract")," from step 4.1."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli deploy DePoolHelper.tvc \'{"pool":"0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace"}\' --abi DePoolHelper.abi.json --sign helper.json --wc 0\n')),(0,l.kt)("h3",{id:"7-configure-depool-state-update-method"},"7. Configure DePool State Update method"),(0,l.kt)("p",null,"There are three different methods of setting up regular state updates of the DePool contract available. You have to set up one of them to run regularly. The period for state updates should be chosen based on the duration of the validation cycle on the blockchain. At the very minimum DePool's state update function should be called four times during the validation cycle:"),(0,l.kt)("p",null,"1) At least twice after the elections begin, so DePool gets ready to receive and forward validator's election request.\n2) Once after the validation begins, to find out if it won elections or not.\n3) Once after unfreeze, to process stakes and rewards and rotate the rounds."),(0,l.kt)("p",null,"In the current network configuration, 1 and 3 coincide, so DePool's state update should be called be called at least three times during the validation cycle - at least twice twice during elections and once during validation."),(0,l.kt)("p",null,"For Rust node you can use the ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/tonlabs/rustnet.ton.dev/blob/main/docker-compose/ton-node/scripts/send_depool_tick_tock.sh"},"provided")," ticktock script, which sends 5 ticktocks after the elections open."),(0,l.kt)("h4",{id:"state-update-through-multisig-contract"},"State update through Multisig Contract"),(0,l.kt)("p",null,"A Multisig wallet can be used instead of Helper to call DePool's ticktock function directly."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] ticktock [-w <msig_address>] [-s <path_to_keys_or_seed_phrase>]\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"--addr <depool_address>")," - the address of the DePool"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"-w <msig_address>")," - the address of the multisig wallet used to call DePool"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"-s <path_to_keys_or_seed_phrase>")," - either the keyfile for the wallet, or the seed phrase in quotes"),(0,l.kt)("p",null,"All these options can be skipped, if they were previously specified in the TONOS-CLI configuration file:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli config --addr <address> --wallet <address> --keys <path_to_keys or seed_phrase>\n")),(0,l.kt)("p",null,"1 token is always attached to this call. Change will be returned."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli depool --addr 0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace ticktock -w 0:1b91c010f35b1f5b42a05ad98eb2df80c302c37df69651e1f5ac9c69b7e90d4e -s "dizzy modify exotic daring gloom rival pipe disagree again film neck fuel"\n')),(0,l.kt)("h4",{id:"state-update-through-depool-helper-contract-temporarily-unavailable"},"State update through DePool Helper contract (temporarily unavailable)"),(0,l.kt)("p",null,"If you have previously deployed DePool helper, you can set it up to regularly call the DePool state update ticktock function. To do it, DePool Helper contract needs to be connected to the global Timer contract. Use the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli call HelperAddress initTimer \'{"timer":"TimerAddress","period":*number*}\' --abi DePoolHelper.abi.json --sign helper.json\n')),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<HelperAddress>")," \u2013 is the address of the Helper contract from step 4.2"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<TimerAddress>")," - is the address of the global timer contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},'"period":*number*')," - is the period for regular DePool contract calls via ticktock messages (in seconds). This period should be chosen based on the duration of the validation cycle on the blockchain. At a minimum DePool Helper contract should be set to call the DePool contract once every step of the validation cycle."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli call 0:1b91c010f35b1f5b42a05ad98eb2df80c302c37df69651e1f5ac9c69b7e90d4e initTimer \'{"timer":"0:3a10ef5d6435e82eb243b41e620f6a7737a70694884aca1c52c99088efb7643d","period":3600}\' --abi DePoolHelper.abi.json --sign helper.json\n')),(0,l.kt)("p",null,"Timer contract and period may be changed at any time with this command."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Timer fees")),(0,l.kt)("p",null,"Timer charges a fee for its services every time the Helper calls it."),(0,l.kt)("p",null,"The fees (in nanoevers) are calculated according to the following formula:"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"fee = period * timerRate + fwdFee * 8 + epsilon")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"timerRate")," = 400000 nanoevers per second"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"fwdFee")," = 1000000 nanoevers"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"epsilon")," = 1e9 nanoevers"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"period")," = the period set in the DePool Helper contract (in seconds)."),(0,l.kt)("p",null,"Thus, the longer the period set in the DePool Helper contract is, the higher a single timer fee will be."),(0,l.kt)("p",null,"To pay these fees reliably, sufficient positive balance (~100 Evers if the period is set to 1 hour) has to be maintained on the Helper. Without funds on the Helper contract, DePool will not be able to function regularly."),(0,l.kt)("h4",{id:"state-update-through-external-call-of-the-depool-helper-contract"},"State update through external call of the DePool Helper Contract"),(0,l.kt)("p",null,"DePool Helper can be called to send the ticktock message manually at any time with the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli call <HelperAddress> sendTicktock {} --abi DePoolHelper.abi.json --sign helper.json\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<HelperAddress>")," \u2013 is the address of the Helper contract from step 4.2."),(0,l.kt)("p",null,"If needed, it can be set up to run regularly (for example, with ",(0,l.kt)("inlineCode",{parentName:"p"},"cron")," utility) to supplement or replace the timer."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"@hourly        cd <tonos-cli-dir> && tonos-cli call <HelperAddress> sendTicktock {} --abi DePoolHelper.abi.json --sign helper.json\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<tonos-cli-dir>")," - directory with TONOS-CLI configuration file, ",(0,l.kt)("inlineCode",{parentName:"p"},"DePoolHelper.abi.json")," file and ",(0,l.kt)("inlineCode",{parentName:"p"},"helper.json")," keyfile containing DePool Helper keys."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<HelperAddress>")," \u2013 address of the Helper contract from step 4.2."),(0,l.kt)("h3",{id:"8-make-stakes"},"8. Make Stakes"),(0,l.kt)("p",null,"DePool collects stakes from various participants to be pooled together and forwarded as one stake to the Elector on behalf of its validator node."),(0,l.kt)("p",null,"Collection is continuous. Stakes can be made at any time, and will be distributed to whichever round is currently in the ",(0,l.kt)("a",{parentName:"p",href:"https://docs.ton.dev/86757ecb2/v/0/p/45d6eb-depool-specifications/t/13b9d0"},"pooling")," stage. Every time an election begins on the blockchain, the accumulated pool is locked and (if all conditions are met) staked in this election, and the pooling stage of the next round begins."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"Note: This means, that a DePool stake for a specific election needs to be made before the election begins.\nTo participate in elections, DePool has to accumulate, through stakes belonging to the validator wallet and, optionally, from other wallets, a staking pool, validator's share of which is not less than ",(0,l.kt)("inlineCode",{parentName:"p"},"validatorAssurance")," (see section 6.1 ",(0,l.kt)("a",{parentName:"p",href:"#61-deploy-depool-contract-to-the-basechain"},"above"),").")),(0,l.kt)("p",null,"TONOS-CLI allows to manage several types of ",(0,l.kt)("a",{parentName:"p",href:"#deposit-stakes"},"stakes"),"."),(0,l.kt)("h5",{id:"depool-fees"},"DePool fees"),(0,l.kt)("p",null,"All staking commands are subject to an additional fee (by default 0.5 evers), that is partially spent to pay for DePool executing the command. The change is then returned to the sender. This value can be adjusted in TONOS-CLI ",(0,l.kt)("a",{parentName:"p",href:"#configure-tonos-cli-for-depool-operations"},"config"),"."),(0,l.kt)("p",null,"Additionally, when DePool receives the stake and rewards back from elector and processes the funds of participants, it uses the rewards to top up its balance:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"first to ",(0,l.kt)("inlineCode",{parentName:"li"},"m_balanceThreshold")," = DePool's balance at the time of ",(0,l.kt)("a",{parentName:"li",href:"#61-deploy-depool-contract-to-the-basechain"},"deployment")," - 5 evers"),(0,l.kt)("li",{parentName:"ol"},"then it takes ",(0,l.kt)("inlineCode",{parentName:"li"},"retOrReinvFee*(N+1)")," tokens, where N is the number of participants.",(0,l.kt)("inlineCode",{parentName:"li"},"retOrReinvFee")," is set to 0,04 evers in the current version of DePool and can only be changed in contract code. It can be viewed through ",(0,l.kt)("inlineCode",{parentName:"li"},"getDePoolInfo")," ",(0,l.kt)("a",{parentName:"li",href:"#getdepoolinfo"},"get-method"),".")),(0,l.kt)("p",null,"These two fees cover DePool's operational expenses and are deducted only from validation rewards. If DePool doesn't receive rewards in a round, it will not be able to top up its balance."),(0,l.kt)("h4",{id:"configure-tonos-cli-for-depool-operations"},"Configure TONOS-CLI for DePool operations"),(0,l.kt)("p",null,"For all commands listed below, the DePool address, the wallet making the stake, the amount of fee to pay for DePool's services and the path to the keyfile/seed phrase may be specified in the TONOS-CLI config file in advance:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli config --addr <address> --wallet <address> --keys <path_to_keys or seed_phrase> --depool_fee <depool_fee>\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"--addr <address>")," - the address of the DePool"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"--wallet <address>")," - the address of the wallet making the stake"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<path_to_keys or seed_phrase>")," - either the keyfile for the wallet making the stake, or the seed phrase in quotes"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"--depool_fee <depool_fee>")," - value in evers, that is additionally attached to the message sent to the DePool to cover its fees. Change is returned to the sender. The default value, used if this option isn't configured, is ",(0,l.kt)("strong",{parentName:"p"},"0.5 evers"),". It should be increased only if it proves insufficient and DePool begins to run out of gas on execution."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli config --addr 0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace --wallet 0:1b91c010f35b1f5b42a05ad98eb2df80c302c37df69651e1f5ac9c69b7e90d4e --keys "dizzy modify exotic daring gloom rival pipe disagree again film neck fuel" --depool_fee 0.8\n')),(0,l.kt)("p",null,"In this case all commands allow to omit ",(0,l.kt)("inlineCode",{parentName:"p"},"--addr"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"--wallet")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"--sign")," options."),(0,l.kt)("h4",{id:"deposit-stakes"},"Deposit stakes"),(0,l.kt)("h5",{id:"1-ordinary-stake"},"1) Ordinary stake"),(0,l.kt)("p",null,"Ordinary stake is the most basic type of stake. It and the rewards from it belong to the wallet that made it."),(0,l.kt)("p",null,"It is invested completely in the current pooling round, and can be reinvested every second round (as odd and even rounds are handled by DePool separately). Thus to participate in every DePool round, an ordinary stake should be invested in two consecutive rounds, so it can later be reinvested in odd and even rounds both."),(0,l.kt)("p",null,"Ordinary stake must exceed DePool minimum stake. Check ",(0,l.kt)("a",{parentName:"p",href:"#getdepoolinfo"},"DePool Info get-method")," to find out the minimum stake."),(0,l.kt)("p",null,"Use the following command to make an ordinary stake:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] stake ordinary [--wallet <msig_address>] --value <number> [--sign <key_file or seed_phrase>]\n")),(0,l.kt)("p",null,"where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<msig_address>")," - address of the wallet making a stake."),(0,l.kt)("p",null,"all ",(0,l.kt)("inlineCode",{parentName:"p"},"--value")," parameters must be defined in evers, like this: ",(0,l.kt)("inlineCode",{parentName:"p"},"--value 10.5"),", which means the value is 10,5 evers."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<key_file or seed_phrase>")," - either the keyfile for the wallet making the stake, or the seed phrase in quotes."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli depool --addr 0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace stake ordinary --wallet 0:1b91c010f35b1f5b42a05ad98eb2df80c302c37df69651e1f5ac9c69b7e90d4e --value 100.5 --sign "dizzy modify exotic daring gloom rival pipe disagree again film neck fuel"\n')),(0,l.kt)("h5",{id:"2-vesting-stake"},"2) Vesting stake"),(0,l.kt)("p",null,"A wallet can make a vesting stake and define a target participant address (beneficiary) who will own this stake, provided the beneficiary has previously indicated the donor as its vesting donor address. This condition prevents unauthorized vestings from blocking the beneficiary from receiving an expected vesting stake from a known address."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"To receive a vesting stake beneficiary must:")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"already have an ordinary stake of any amount in the DePool (it can be made by the participant itself, or ",(0,l.kt)("a",{parentName:"p",href:"#transfer-stakes"},"transferred")," from another participant)")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("p",{parentName:"li"},"set the donor address with the following command:"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] donor vesting [--wallet <beneficiary_address>] --donor <donor_address> [--sign <key_file or seed_phrase>]\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<beneficiary_address>")," - address of the beneficiary wallet ."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<donor_address>")," - address of the donor wallet."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<key_file or seed_phrase>")," - either the keyfile for the beneficiary wallet, or the seed phrase in quotes."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli depool --addr 0:3187b4d738d69776948ca8543cb7d250c042d7aad1e0aa244d247531590b9147 donor vesting --wallet 0:255a3ad9dfa8aa4f3481856aafc7d79f47d50205190bd56147138740e9b177f3 --donor 0:279afdbd7b2cbf9e65a5d204635a8630aec2baec60916ffdc9c79a09d2d2893d --sign "deal hazard oak major glory meat robust teach crush plastic point edge"\n')),(0,l.kt)("p",null,"Not the whole stake is available to the beneficiary at once. Instead it is split into parts and the next part of stake becomes available to the beneficiary (is transformed into beneficiary's ordinary stake) at the end of the round that coincides with the end of the next withdrawal period. Rewards from vesting stake are always added to the beneficiary's ordinary stake. To withdraw these funds, beneficiary should use one of the ",(0,l.kt)("a",{parentName:"p",href:"#withdraw-stakes"},"withdrawal functions"),"."),(0,l.kt)("p",null,"Please note, that the vesting stake is split into two equal parts by the DePool, to be used in both odd and even rounds, so to ensure DePool can participate in elections with just one vesting stake where validator wallet is beneficiary, the stake should exceed ",(0,l.kt)("inlineCode",{parentName:"p"},"validatorAssurance"),(0,l.kt)("em",{parentName:"p"},"2. Similarly, to ensure any vesting stake is accepted, make sure it exceeds ",(0,l.kt)("inlineCode",{parentName:"em"},"minStake")," "),"2."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Vesting for validator beneficiaries is subject to additional rules:")," At the end of every withdrawal period, the part of the vesting stake to be released is divided proportionally into 2 parts - for rounds in this period when DePool successfully completed validation and received a reward (without slashing) and for rounds when DePool missed elections or was slashed. The portion of the stake corresponding to the successful rounds is sent to the validator, while the portion corresponding to the failed rounds is returned to the vesting stake donor. For example, if there were 100 rounds within the withdrawal period, and DePool successfully completed 80 of them, missed elections in 5 more and was slashed in the remaining 15, the validator will receive 80% of the unlocked part of the vesting stake, and the stake donor will get back 20% of it."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Donor uses the following command to make a vesting stake:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] stake vesting [--wallet <msig_address>] --value <number> --total <days> --withdrawal <days> --beneficiary <address> [--sign <key_file or seed_phrase>]\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<msig_address>")," - address of the wallet making a stake."),(0,l.kt)("p",null,"all ",(0,l.kt)("inlineCode",{parentName:"p"},"--value")," parameters must be defined in evers, like this: ",(0,l.kt)("inlineCode",{parentName:"p"},"--value 10.5"),", which means the value is 10,5 evers."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"total <days>")," - total period, for which the stake is made."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"withdrawal <days>")," - withdrawal period (each time a withdrawal period ends, a portion of the stake is released to the beneficiary)."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"There are limitations for period settings: ",(0,l.kt)("inlineCode",{parentName:"p"},"withdrawalPeriod")," should be <= ",(0,l.kt)("inlineCode",{parentName:"p"},"totalPeriod"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"totalPeriod")," cannot exceed 18 years or be <=0, ",(0,l.kt)("inlineCode",{parentName:"p"},"totalPeriod")," should be exactly divisible by withdrawalPeriod.\n",(0,l.kt)("inlineCode",{parentName:"p"},"beneficiary <address>")," - address of the wallet that will receive rewards from the stake and, in parts over time, the vesting stake itself. Cannot be the same as the wallet making the stake.")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<key_file or seed_phrase>")," - either the keyfile for the wallet making the stake, or the seed phrase in quotes."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli depool --addr 0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace stake vesting --wallet 0:1b91c010f35b1f5b42a05ad98eb2df80c302c37df69651e1f5ac9c69b7e90d4e --value 1000 --total 360 --withdrawal 30 --beneficiary 0:f22e02a1240dd4b5201f8740c38f2baf5afac3cedf8f97f3bd7cbaf23c7261e3 --sign "dizzy modify exotic daring gloom rival pipe disagree again film neck fuel"\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"Note"),": Each participant can be the beneficiary of only one vesting stake. Once the current vesting stake expires, another can be made for the participant."),(0,l.kt)("h5",{parentName:"blockquote",id:"3-lock-stake"},"3) Lock stake")),(0,l.kt)("p",null,"A wallet can make a lock stake, in which it locks its funds in DePool for a defined period, but rewards from this stake will be payed to another target participant (beneficiary). As with vesting, the beneficiary has to indicate the donor as its lock donor address before receiving a lock stake. This condition prevents unauthorized lock stakes from blocking the beneficiary from receiving an expected lock stake from a known address."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"To receive a lock stake beneficiary must:")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"already have an ordinary stake of any amount in the DePool (it can be made by the participant itself, or ",(0,l.kt)("a",{parentName:"li",href:"#transfer-stakes"},"transferred")," from another participant)"),(0,l.kt)("li",{parentName:"ul"},"set the donor address with the following command:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] donor lock [--wallet <beneficiary_address>] --donor <donor_address> [--sign <key_file or seed_phrase>]\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<beneficiary_address>")," - address of the beneficiary wallet ."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<donor_address>")," - address of the donor wallet."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<key_file or seed_phrase>")," - either the keyfile for the beneficiary wallet, or the seed phrase in quotes."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli depool --addr 0:3187b4d738d69776948ca8543cb7d250c042d7aad1e0aa244d247531590b9147 donor lock --wallet 0:255a3ad9dfa8aa4f3481856aafc7d79f47d50205190bd56147138740e9b177f3 --donor 0:279afdbd7b2cbf9e65a5d204635a8630aec2baec60916ffdc9c79a09d2d2893d --sign "deal hazard oak major glory meat robust teach crush plastic point edge"\n')),(0,l.kt)("p",null,"Like vesting stake, lock stake can be configured to be unlocked in parts at the end of each round that coincides with the end of the next withdrawal period. At the end of each period a part of the Lock Stake is returned to the wallet which locked it. The rewards of a lock stake are always added to the ordinary stake of the beneficiary. To withdraw these funds, beneficiary should use one of the ",(0,l.kt)("a",{parentName:"p",href:"#withdraw-stakes"},"withdrawal functions"),"."),(0,l.kt)("p",null,"Please note that the lock stake is split into two equal parts by the DePool, to be used in both odd and even rounds, so to ensure DePool can participate in elections with just one lock stake where validator wallet is beneficiary, the stake should equal ",(0,l.kt)("inlineCode",{parentName:"p"},"validatorAssurance")," ",(0,l.kt)("em",{parentName:"p"},"2. Similarly, to ensure any vesting stake is accepted, make sure it exceeds ",(0,l.kt)("inlineCode",{parentName:"em"},"minStake")," "),"2."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Donor uses the following command to make a lock stake:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] stake lock [--wallet <msig_address>] --value <number> --total <days> --withdrawal <days> --beneficiary <address> [--sign <key_file or seed_phrase>]\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<msig_address>")," - address of the wallet making a stake."),(0,l.kt)("p",null,"all ",(0,l.kt)("inlineCode",{parentName:"p"},"--value")," parameters must be defined in evers, like this: ",(0,l.kt)("inlineCode",{parentName:"p"},"--value 10.5"),", which means the value is 10,5 evers."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"total <days>")," - total period, for which the stake is made. "),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"withdrawal <days>")," - withdrawal period (each time a withdrawal period ends, a portion of the stake is returned to the wallet that made the stake). "),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"There are limitations for period settings: ",(0,l.kt)("inlineCode",{parentName:"p"},"withdrawalPeriod")," should be <= ",(0,l.kt)("inlineCode",{parentName:"p"},"totalPeriod"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"totalPeriod")," cannot exceed 18 years or be <=0, ",(0,l.kt)("inlineCode",{parentName:"p"},"totalPeriod")," should be exactly divisible by withdrawalPeriod.\n",(0,l.kt)("inlineCode",{parentName:"p"},"beneficiary <address>")," - address of the wallet that will receive rewards from the stake. Cannot be the same as the wallet making the stake.")),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"key_file or seed_phrase")," - either the keyfile for the wallet making the stake, or the seed phrase in quotes."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli depool --addr 0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace stake lock --wallet 0:1b91c010f35b1f5b42a05ad98eb2df80c302c37df69651e1f5ac9c69b7e90d4e --value 1000 --total 360 --withdrawal 30 --beneficiary 0:f22e02a1240dd4b5201f8740c38f2baf5afac3cedf8f97f3bd7cbaf23c7261e3 --sign "dizzy modify exotic daring gloom rival pipe disagree again film neck fuel"\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"Note"),": Each participant can be the beneficiary of only one lock stake. Once the current lock stake expires, another can be made for the participant."),(0,l.kt)("h4",{parentName:"blockquote",id:"remove-stakes"},"Remove stakes")),(0,l.kt)("p",null,"This command removes an ordinary stake from a pooling round (while it has not been staked in the Elector yet):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] stake remove [--wallet <msig_address>] --value <number> [--sign <key_file or seed_phrase>]\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<msig_address>")," - address of the wallet that made the stake."),(0,l.kt)("p",null,"all ",(0,l.kt)("inlineCode",{parentName:"p"},"--value")," parameters must be defined in evers, like this: ",(0,l.kt)("inlineCode",{parentName:"p"},"--value 10.5"),", which means the value is 10,5 evers."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<key_file or seed_phrase>")," - either the keyfile for the wallet making the stake, or the seed phrase in quotes."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli depool --addr 0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace stake remove --wallet 0:1b91c010f35b1f5b42a05ad98eb2df80c302c37df69651e1f5ac9c69b7e90d4e --value 100 --sign "dizzy modify exotic daring gloom rival pipe disagree again film neck fuel"\n')),(0,l.kt)("h4",{id:"transfer-stakes"},"Transfer stakes"),(0,l.kt)("p",null,"The following command assigns an existing ",(0,l.kt)("a",{parentName:"p",href:"#1-ordinary-stake"},"ordinary stake")," or its part to another participant wallet. If the entirety of the stake is transferred, the transferring wallet is removed from the list of participants in the DePool. If the receiving wallet isn't listed among the participants, it will become a participant as the result of the command."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] stake transfer [--wallet <msig_address>] --value <number> --dest <address> [--sign <key_file or seed_phrase>]\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<msig_address>")," - address of the wallet that made the stake."),(0,l.kt)("p",null,"all ",(0,l.kt)("inlineCode",{parentName:"p"},"--value")," parameters must be defined in evers, like this: ",(0,l.kt)("inlineCode",{parentName:"p"},"--value 10.5"),", which means the value is 10,5 evers."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"dest <address>")," - address of the new owner of the stake."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<key_file or seed_phrase>")," - either the keyfile for the wallet making the stake, or the seed phrase in quotes."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli depool --addr 0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace stake transfer --wallet 0:1b91c010f35b1f5b42a05ad98eb2df80c302c37df69651e1f5ac9c69b7e90d4e --value 1000 --dest 0:1b91c010f35b1f5b42a05ad98eb2df80c302c37df69651e1f5ac9c69b7e90d4e --sign "dizzy modify exotic daring gloom rival pipe disagree again film neck fuel"\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"Note"),": Stakes cannot be transferred from or to DePool's validator wallet, and between any wallets during round completion step (RoundStep = Completing = 8).")),(0,l.kt)("h4",{id:"withdraw-stakes"},"Withdraw Stakes"),(0,l.kt)("h5",{id:"1-withdraw-entire-stake"},"1) Withdraw entire stake"),(0,l.kt)("p",null,"The following command allows to withdraw an ",(0,l.kt)("a",{parentName:"p",href:"#1-ordinary-stake"},"ordinary stake")," to the wallet that owns it, as soon as the stake becomes available. Use ",(0,l.kt)("inlineCode",{parentName:"p"},"withdraw on")," to receive the stake, once it's unlocked. If you then make another stake, and want to keep reinvesting it every round, run the command with ",(0,l.kt)("inlineCode",{parentName:"p"},"withdraw off"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] withdraw on | off [--wallet <msig_address>] [--sign <key_file or seed_phrase>]\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<msig_address>")," - address of the wallet that made the stake."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<key_file or seed_phrase>")," - either the keyfile for the wallet that made the stake, or the seed phrase in quotes."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli depool --addr 0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace withdraw on --wallet 0:1b91c010f35b1f5b42a05ad98eb2df80c302c37df69651e1f5ac9c69b7e90d4e --sign "dizzy modify exotic daring gloom rival pipe disagree again film neck fuel"\n')),(0,l.kt)("h5",{id:"2-withdraw-part-of-the-stake"},"2) Withdraw part of the stake"),(0,l.kt)("p",null,"The following command allows to withdraw part of an ",(0,l.kt)("a",{parentName:"p",href:"#1-ordinary-stake"},"ordinary stake")," to the wallet that owns it, as soon as the stake becomes available. If, as result of this withdrawal, participant's ordinary stake becomes less than ",(0,l.kt)("inlineCode",{parentName:"p"},"minStake"),", then participant's whole stake is sent to participant."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] stake withdrawPart [--wallet <msig_address>] --value <number> [--sign <key_file or seed_phrase>]\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<msig_address>")," - address of the wallet that made the stake."),(0,l.kt)("p",null,"all ",(0,l.kt)("inlineCode",{parentName:"p"},"--value")," parameters must be defined in evers, like this: ",(0,l.kt)("inlineCode",{parentName:"p"},"--value 10.5"),", which means the value is 10,5 evers."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<key_file or seed_phrase>")," - either the keyfile for the wallet that made the stake, or the seed phrase in quotes."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli depool --addr 0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace stake withdrawPart --wallet 0:1b91c010f35b1f5b42a05ad98eb2df80c302c37df69651e1f5ac9c69b7e90d4e --value 1000 --sign "dizzy modify exotic daring gloom rival pipe disagree again film neck fuel"\n')),(0,l.kt)("h4",{id:"reinvest-stakes"},"Reinvest Stakes"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"#1-ordinary-stake"},"Ordinary")," stake reinvestment is controlled by the DePool ",(0,l.kt)("a",{parentName:"p",href:"https://docs.ton.dev/86757ecb2/p/45d6eb-depool-specifications/t/82306f"},"reinvest flag"),". By default this flag is set to ",(0,l.kt)("inlineCode",{parentName:"p"},"yes"),", and the the participant's available ordinary stake will be reinvested every round, no additional action required.\nIt gets set to ",(0,l.kt)("inlineCode",{parentName:"p"},"no")," when ",(0,l.kt)("a",{parentName:"p",href:"#1-withdraw-entire-stake"},"withdrawing the entire stake"),". After stake withdrawal it remains set to ",(0,l.kt)("inlineCode",{parentName:"p"},"no"),".\nTo re-enable ordinary stake reinvesting after withdrawing a stake, run the withdraw command with option ",(0,l.kt)("inlineCode",{parentName:"p"},"off"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] withdraw off [--wallet <msig_address>] [--sign <key_file or seed_phrase>]\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<msig_address>")," - address of the wallet that made the stake."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<key_file or seed_phrase>")," - either the keyfile for the wallet that made the stake, or the seed phrase in quotes."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli depool --addr 0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace withdraw off --wallet 0:1b91c010f35b1f5b42a05ad98eb2df80c302c37df69651e1f5ac9c69b7e90d4e --sign "dizzy modify exotic daring gloom rival pipe disagree again film neck fuel"\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"Note:"),"\n",(0,l.kt)("a",{parentName:"p",href:"#2-withdraw-part-of-the-stake"},"Withdrawing a part of the stake")," does not affect the reinvest flag.\n",(0,l.kt)("a",{parentName:"p",href:"#3-lock-stake"},"Lock")," and ",(0,l.kt)("a",{parentName:"p",href:"#2-vesting-stake"},"vesting")," stakes are reinvested according to their initial settings for the full duration of the staking period. There is no way to change these settings once lock and vesting stakes are made.")),(0,l.kt)("h3",{id:"9-check--donors-and-stakes-in-the-depool"},"9. Check  Donors and Stakes in the DePool"),(0,l.kt)("p",null,"After the stake is made, you can check its status in the DePool with the ",(0,l.kt)("inlineCode",{parentName:"p"},"getParticipantInfo")," get-method:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli run <depool_address> getParticipantInfo \'{"addr":"<msig_address>"}\' --abi DePool.abi.json\n')),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<msig_address>")," - address of the wallet that made the stake."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"Note"),": if you are expecting a lock or vesting stake, make sure the donor address is specified in your ",(0,l.kt)("inlineCode",{parentName:"p"},"lockDonor")," or ",(0,l.kt)("inlineCode",{parentName:"p"},"vestingDonor")," parameters.")),(0,l.kt)("h3",{id:"10-set-up-validator-script"},"10. Set Up Validator Script"),(0,l.kt)("p",null,"Once the the validator has accumulated a stake sufficient to participate in elections, (at least ",(0,l.kt)("inlineCode",{parentName:"p"},"validatorAssurance"),"), this stake needs to be signed by the node. This should be done through a validator script."),(0,l.kt)("p",null,"The main function that the validator script should regularly perform is to send signed election requests to the DePool, which will forward the accumulated stake to the Elector contract on the validator's behalf. The Election request should be generated with the proxy address for the current round as the requesting validator wallet."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"When participating in elections through a DePool contract, the validator script handles only the creation and sending of the node election request, as ",(0,l.kt)("strong",{parentName:"p"},"all activities regarding stakes and rewards are handled at the level of the DePool"),".\n",(0,l.kt)("strong",{parentName:"p"},"Note"),", that the validator wallet should have a small sum of tokens (~20 Evers) available at all times to reliably send election requests to DePool. Each election request costs ~ 1 Ton.\n",(0,l.kt)("strong",{parentName:"p"},"Note"),": Do not forget to ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/tonlabs/ton-labs-contracts/tree/master/solidity/safemultisig#47-create-transaction-confirmation-online"},"confirm")," the election request transactions sent out by the script with the necessary amount of validator wallet custodians.")),(0,l.kt)("h4",{id:"for-c-node"},"For C++ node"),(0,l.kt)("p",null,"Working examples of such a script can be found here: for the ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/tonlabs/main.ton.dev/blob/master/scripts/validator_depool.sh"},"main Everscale")," network, and for the ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/tonlabs/net.ton.dev/blob/master/scripts/validator_depool.sh"},"devnet"),"."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"Important"),": If you are setting up DePool validator script on top of a ",(0,l.kt)("strong",{parentName:"p"},"C++ node"),", that was previously functioning under a regular validator script, you should first disable the regular script (validator_msig.sh) and only set up the DePool validator script (validator_depool.sh) for the next elections. Two validator scripts should never run at the same time, as this creates unpredictable behavior.\nIt is recommended to run the script periodically, for example with ",(0,l.kt)("inlineCode",{parentName:"p"},"cron")," utility. Example:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'@hourly        script --return --quiet --append --command "cd /scripts/ && ./validator_depool.sh 2>&1" /var/ton-work/validator_depool.log\n')),(0,l.kt)("p",null,"It is possible to configure the script to monitor the DePool status through the available get-methods, such as ",(0,l.kt)("inlineCode",{parentName:"p"},"getParticipantInfo"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"getRounds"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"getDePoolInfo"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"getParticipants")," (see ",(0,l.kt)("a",{parentName:"p",href:"#using-get-methods"},"get-methods section")," for details) and through ",(0,l.kt)("a",{parentName:"p",href:"#using-depool-events"},"view DePool events command"),"."),(0,l.kt)("h4",{id:"for-rust-node"},"For Rust Node"),(0,l.kt)("p",null,"For rustnet, the script is set up automatically during node deployment."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"Important"),": If you are switching a ",(0,l.kt)("strong",{parentName:"p"},"rust validator node")," from direct staking to DePool, make sure to delete the current node build, set the DePool validator variable and rebuild it from scratch.")),(0,l.kt)("h3",{id:"11-maintain-positive-balance-on-depool-and-supplementary-contracts"},"11. Maintain Positive Balance on DePool and Supplementary Contracts"),(0,l.kt)("h4",{id:"depool-balance"},"DePool Balance"),(0,l.kt)("p",null,"Normally the DePool receives sufficient funds for its operations ",(0,l.kt)("a",{parentName:"p",href:"#depool-fees"},"from validation rewards"),". They go to DePool's own balance, which is completely separate from the staking pool and the funds on it are never staked."),(0,l.kt)("p",null,"However, a situation where the DePool spends its funds on regular operations, but does not receive enough rewards (for example, fails to participate in the elections or loses them), is possible."),(0,l.kt)("p",null,"DePool balance can be viewed or through ",(0,l.kt)("inlineCode",{parentName:"p"},"getDePoolBalance")," ",(0,l.kt)("a",{parentName:"p",href:"#getdepoolbalance"},"get-method")," in TONOS-CLI (requires ",(0,l.kt)("inlineCode",{parentName:"p"},"DePool.abi.json")," file):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli run <depool_address> getDePoolBalance {} --abi DePool.abi.json\n")),(0,l.kt)("p",null,"Additionally, DePool emits the ",(0,l.kt)("inlineCode",{parentName:"p"},"TooLowDePoolBalance")," ",(0,l.kt)("a",{parentName:"p",href:"#using-depool-events"},"event")," when its balance drops too low to perform state update operations (below ",(0,l.kt)("inlineCode",{parentName:"p"},"CRITICAL_THRESHOLD")," which equals 10 evers)."),(0,l.kt)("p",null,"Replenish the balance to at least 20 evers from any multisignature wallet with the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] replenish --value *number* [--wallet <msig_address>] [--sign <key_file or seed_phrase>]\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,"all ",(0,l.kt)("inlineCode",{parentName:"p"},"--value")," parameters must be defined in evers, like this: ",(0,l.kt)("inlineCode",{parentName:"p"},"--value 150.5"),", which means the value is 150,5 evers."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<msig_address>")," - address of the wallet that made the stake."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<key_file or seed_phrase>")," - either the keyfile for the wallet, or the seed phrase in quotes."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli depool --addr 0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace replenish --value 150 --wallet 0:1b91c010f35b1f5b42a05ad98eb2df80c302c37df69651e1f5ac9c69b7e90d4e --sign "dizzy modify exotic daring gloom rival pipe disagree again film neck fuel"\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"Note: These funds do not go towards any stake. They are transferred to the DePool contract itself and are spent on its operational expenses.")),(0,l.kt)("h4",{id:"proxy-balance"},"Proxy Balance"),(0,l.kt)("p",null,"The balance of ~ 2 Evers on the proxies should be maintained for the full duration of DePool existence."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Generally proxies receive fees for their services automatically, but if they run out of funds for any reason, DePool might miss elections.")),(0,l.kt)("p",null,"As the proxies are deployed by the DePool itself, you have to run the ",(0,l.kt)("inlineCode",{parentName:"p"},"getDePoolInfo")," get-method to find out their addresses:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli run <depool_address> getDePoolInfo {} --abi DePool.abi.json\n")),(0,l.kt)("p",null,"The balance of the proxies can be viewed on the ",(0,l.kt)("a",{parentName:"p",href:"https://ever.live/main"},"ever.live")," blockchain explorer by searching the proxy addresses, or through TONOS-CLI commands:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli account <proxy0_address>\ntonos-cli account <proxy1_address>\n")),(0,l.kt)("p",null,"If necessary, it can be topped up with a ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/tonlabs/ton-labs-contracts/tree/master/solidity/safemultisig#46-create-transaction-online"},"transaction")," from any multisignature wallet:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli call <wallet_address> submitTransaction \'{"dest":"<proxy_address>","value":*number*,"bounce":"true","allBalance":"false","payload":""}\' --abi <MultisigWallet.abi.json> --sign <wallet_seed_or_keyfile>\n')),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<wallet_address>")," - is the address of the wallet, from which you are making the transaction"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<proxy_address>")," - address of one of the proxies, calculated on step 4."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},'"value":*number*')," - the amount of coins to be transferred (in nanotokens)."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<MultisigWallet.abi.json>")," - the ABI file of the contract, from which you are making the transaction (for validator wallets - usually ",(0,l.kt)("inlineCode",{parentName:"p"},"SafeMultisigWallet.abi.json"),")"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<wallet_seed_or_keyfile>")," - either the seed phrase in double quotes, or the path to the keyfile for the wallet, from which you are making the transaction"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"Note"),": If the proxy balance dips too low to operate and it fails to deliver messages between DePool and elector, DePool will emit one of the following ",(0,l.kt)("a",{parentName:"p",href:"#using-depool-events"},"events"),": ",(0,l.kt)("inlineCode",{parentName:"p"},"ProxyHasRejectedTheStake")," (if proxy cannot pass the stake on to elector) or ",(0,l.kt)("inlineCode",{parentName:"p"},"ProxyHasRejectedRecoverRequest")," (if proxy cannot retrieve stake from elector). To reestablish operations you need to top up the proxy balance, and then call the DePool ",(0,l.kt)("inlineCode",{parentName:"p"},"ticktock")," function by ",(0,l.kt)("a",{parentName:"p",href:"#7-configure-depool-state-update-method"},"any available means"),". These measures should be taken as soon as possible, however, as DePool risks missing elections if it cannot communicate with elector on time.")),(0,l.kt)("h5",{id:"withdrawing-excess-funds"},"Withdrawing excess funds"),(0,l.kt)("p",null,"If proxy accumulates excess funds over time, they can be withdrawn using a transaction from the validator wallet with a specific payload:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli call <validator_wallet> submitTransaction \'{"dest":"<proxy_address>","value": 500000000,"bounce": true,"allBalance": false, "payload": "te6ccgEBAQEABgAACFBK1Rc="}\' --abi <MultisigWallet.abi.json> --sign <seed_phrase_or_key_file>\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<validator_wallet>")," - address of the validator wallet."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<proxy_address>")," - address of the proxy contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<MultisigWallet.abi.json>")," - validator wallet ABI file (usually SafeMultisigWallet.abi.json)."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<seed_phrase_or_key_file>")," - either the keyfile for the validator wallet, or the seed phrase in quotes."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"payload")," contains the message calling the ",(0,l.kt)("inlineCode",{parentName:"p"},"withdrawExcessTons()")," function of the proxy contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"value"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"bounce"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"allBalance")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"payload")," values should not be modified. Change from the 0.5 evers not spent on the transaction will be returned."),(0,l.kt)("p",null,"Proxy will send all excess funds to the validator wallet, reserving only its minimal balance of 2 evers for itself."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli call 0:303c1aa8110dc5c543687c6bba699add7a7faf2ed55737f494f78d1c51c6b8d4 submitTransaction \'{"dest":"-1:d16999c37c82523d1931011471967ae9e06ee53c1cafcacc8f6d3bee34f15044","value": 500000000,"bounce": true,"allBalance": false, "payload": "te6ccgEBAQEABgAACFBK1Rc="}\' --abi SafeMultisigWallet.abi.json --sign "kick jewel fiber because cushion brush elegant fox bus surround pigeon divide"\n')),(0,l.kt)("h4",{id:"depool-helper-balance"},"DePool Helper Balance"),(0,l.kt)("p",null,"The balance of ~ 100 Evers on the helper contract should be maintained for the full duration of DePool existence."),(0,l.kt)("p",null,"The balance of the helper can be viewed on the ",(0,l.kt)("a",{parentName:"p",href:"https://ever.live/main"},"ever.live")," blockchain explorer by searching the helper address, or through TONOS-CLI command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli account <helper_address>\n")),(0,l.kt)("p",null,"Helper balance should be topped up regularly. Without funds on the Helper contract, DePool will not be able to function regularly."),(0,l.kt)("p",null,"To top up, send a ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/tonlabs/ton-labs-contracts/tree/master/solidity/safemultisig#46-create-transaction-online"},"transaction")," from any multisignature wallet:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli call <wallet_address> submitTransaction \'{"dest":"<helper_address>","value":*number*,"bounce":"true","allBalance":"false","payload":""}\' --abi <MultisigWallet.abi.json> --sign <wallet_seed_or_keyfile>\n')),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<wallet_address>")," - is the address of the wallet, from which you are making the transaction."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<helper_address>")," - address of the helper, calculated on step 4."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},'"value":*number*')," - the amount of coins to be transferred (in nanotokens)."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<MultisigWallet.abi.json>")," - the ABI file of the contract, from which you are making the transaction (for validator wallets - usually ",(0,l.kt)("inlineCode",{parentName:"p"},"SafeMultisigWallet.abi.json"),")."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<wallet_seed_or_keyfile>")," - either the seed phrase in double quotes, or the path to the keyfile for the wallet, from which you are making the transaction."),(0,l.kt)("h4",{id:"validator-wallet-balance"},"Validator Wallet Balance"),(0,l.kt)("p",null,"Validator wallet will receive a fraction of any DePool round rewards directly, so with a successful DePool setup, it should receive regular income."),(0,l.kt)("p",null,"In general, the validator wallet should have a small sum of tokens (~20 Evers) available at all times to reliably send election requests to DePool. Each election request costs ~ 1 Ton."),(0,l.kt)("h3",{id:"12-check-depool-status-in-the-elections"},"12. Check DePool Status in the Elections"),(0,l.kt)("p",null,"Once everything has been configured properly, ",(0,l.kt)("a",{parentName:"p",href:"#8-make-stakes"},"stakes made"),", and election request sent by the ",(0,l.kt)("a",{parentName:"p",href:"#10-set-up-validator-script"},"validator script"),", you can monitor the operation of the DePool and its validator node through various channels."),(0,l.kt)("h4",{id:"on-everlive"},"On ever.live"),(0,l.kt)("p",null,"Nodes currently participating in an open election are displayed on ",(0,l.kt)("a",{parentName:"p",href:"https://ever.live/validators?section=all"},"ever.live")," in the ",(0,l.kt)("strong",{parentName:"p"},"Next")," validators section until election end."),(0,l.kt)("p",null,"When the elections end, the newly elected set of validators is posted on ",(0,l.kt)("a",{parentName:"p",href:"https://ever.live/validators?section=all"},"ever.live")," in the ",(0,l.kt)("strong",{parentName:"p"},"Next")," validators section."),(0,l.kt)("p",null,"When the new validator set becomes active, it is moved to the ",(0,l.kt)("strong",{parentName:"p"},"Current")," section. At that point you will be able to see new blocks signed by the validator node on its validator page."),(0,l.kt)("p",null,"To find the pages of your validator and DePool, you can search for the validator wallet or for the DePool address on ",(0,l.kt)("a",{parentName:"p",href:"https://ever.live/"},"ever.live"),". All validator-related pages are linked to each other."),(0,l.kt)("h4",{id:"using-depool-events"},"Using DePool Events"),(0,l.kt)("p",null,"TONOS-CLI supports DePool event monitoring."),(0,l.kt)("p",null,"To print out all events, or, optionally, all events since a specific time use the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] events [--since <utime>]\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<utime>")," - unixtime, since which the events are displayed. If ",(0,l.kt)("inlineCode",{parentName:"p"},"-since")," is omitted, all DePool events are printed."),(0,l.kt)("p",null,"To wait for a new event use the following command."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] events --wait-one\n")),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,"TONOS-CLI waits until new event will be emitted and then prints it to the stdout."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool --addr 0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace events --wait-one\n")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"List of possible events:")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"DePoolClosed()")," - event emitted when DePool is closing."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"RoundStakeIsAccepted(uint64 queryId, uint32 comment)")," - event emitted when Elector accepts the stake."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"RoundStakeIsRejected(uint64 queryId, uint32 comment)")," - event emitted when Elector rejects the stake."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"ProxyHasRejectedTheStake(uint64 queryId)")," - event is emitted if stake is returned by proxy because too low balance of proxy contract."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"ProxyHasRejectedRecoverRequest(uint64 roundId)")," - event is emitted if stake cannot be returned from elector because too low balance of proxy contract."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"RoundCompleted(TruncatedRound round)")," - event emitted when the round was completed."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"StakeSigningRequested(uint32 electionId, address proxy)")," - event emitted when round switches from pooling to election indicating that DePool is waiting for signed election request from validator wallet."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"TooLowDePoolBalance(uint replenishment)")," - event emitted when DePool's own balance becomes too low to perform state update operations (below ",(0,l.kt)("inlineCode",{parentName:"li"},"CRITICAL_THRESHOLD")," which equals 10 evers). ",(0,l.kt)("inlineCode",{parentName:"li"},"replenishment")," indicates the minimal value required to resume operations. It's recommended to replenish the balance to 20 evers or more if this event occurs."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"RewardFractionsChanged(uint8 validator, uint8 participants)")," - event emitted when contract owner changes reward fractions. validator - validator's reward fraction. participants - participants' reward fraction."),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("inlineCode",{parentName:"li"},"InternalError(uint16 ec)")," - emitted whenever an internal error occurs. Contains error code.")),(0,l.kt)("p",null,"Events command output example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'event ee4f1e53997f7c5cd3a03511f8ed8e5715ead58e9645b4c99f91b56f0a4bd07b\nRoundStakeIsAccepted 1611665778 (2021-01-26 12:56:18.000)\n{"queryId":"1611665701","comment":"0"}\nevent 14ed78bb338cc94b2e1165f71de732d092ff203941e027bfe2b5e20bdc0a90ee\nStakeSigningRequested 1611665471 (2021-01-26 12:51:11.000)\n{"electionId":"1611666134","proxy":"-1:1ef217ee3f9aa5cd2202919c97e1b61caddcb1a80f450d82990a06b918a75d82"}\nevent c884939b93dcf846ab43f1bbc36977fabe57bf376fa3638d95b2e7127ed4f0c2\nRoundCompleted 1611665471 (2021-01-26 12:51:11.000)\n{"round":{"id":"159","supposedElectedAt":"1611664334","unfreeze":"0","stakeHeldFor":"900","vsetHashInElectionPhase":"0xc09caf4efff6cabff6185754d2150bc11d94098f97ea146a617e9d0d90cecc76","step":"8","completionReason":"3","stake":"2525331200749","recoveredStake":"0","unused":"0","isValidatorStakeCompleted":false,"rewards":"0","participantQty":"1","validatorStake":"2525331200749","validatorRemainingStake":"0","handledStakesAndRewards":"0"}}\n')),(0,l.kt)("h4",{id:"using-get-methods"},"Using get-methods"),(0,l.kt)("p",null,"DePool contract supports a number of get-methods, which can be used to monitor its status and the status of participants and stakes in the pool."),(0,l.kt)("h5",{id:"getparticipantinfoaddress-addr"},(0,l.kt)("inlineCode",{parentName:"h5"},"getParticipantInfo(address addr)")),(0,l.kt)("p",null,"Returns information about a specific participant in all investment rounds."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli run <depool_address> getParticipantInfo \'{"addr":"<msig_address>"}\' --abi DePool.abi.json\n')),(0,l.kt)("p",null,"Where"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"<msig_address>")," - address of the wallet that made the stake."),(0,l.kt)("p",null,"Output example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'Result: {\n  "total": "107043197878158",\n  "withdrawValue": "0",\n  "reinvest": true,\n  "reward": "5837197878158",\n  "stakes": {\n    "160": "104517866677409",\n    "161": "2525331200749"\n  },\n  "vestings": {},\n  "locks":  {\n    "160": {\n      "lastWithdrawalTime": "1604655095",\n      "owner": "0:6cde10682ab1f72f267ce4a47a439db6473be65ba87dc846556fbabdba8bfb78",\n      "remainingAmount": "100000500000000",\n      "withdrawalPeriod": "1728000",\n      "withdrawalValue": "100000500000000"\n    },\n    "161": {\n      "lastWithdrawalTime": "1604655095",\n      "owner": "0:6cde10682ab1f72f267ce4a47a439db6473be65ba87dc846556fbabdba8bfb78",\n      "remainingAmount": "100000500000000",\n      "withdrawalPeriod": "1728000",\n      "withdrawalValue": "100000500000000"\n    },\n  "vestingDonor": "0:6cde10682ab1f72f267ce4a47a439db6473be65ba87dc846556fbabdba8bfb78",\n  "lockDonor": "0:6cde10682ab1f72f267ce4a47a439db6473be65ba87dc846556fbabdba8bfb78"\n}\n')),(0,l.kt)("p",null,"The participant parameters displayed by the get-method are the following:\n",(0,l.kt)("inlineCode",{parentName:"p"},"total"),": participant's total stake (in nanoevers).\n",(0,l.kt)("inlineCode",{parentName:"p"},"withdrawValue"),": the value to be withdrawn when the funds become available.\n",(0,l.kt)("inlineCode",{parentName:"p"},"reinvest"),": whether the ordinary stake of the participant should be continuously ",(0,l.kt)("a",{parentName:"p",href:"#reinvest-stakes"},"reinvested"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"reward"),": The total rewards earned by participant in the current DePool (in nanoevers).\n",(0,l.kt)("inlineCode",{parentName:"p"},"stakes"),": the ",(0,l.kt)("a",{parentName:"p",href:"#1-ordinary-stake"},"ordinary")," stakes in the current active rounds (in nanoevers).\n",(0,l.kt)("inlineCode",{parentName:"p"},"locks")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"vestings"),": participant's ",(0,l.kt)("a",{parentName:"p",href:"#3-lock-stake"},"lock")," and ",(0,l.kt)("a",{parentName:"p",href:"#2-vesting-stake"},"vesting")," stake, each split into two neighboring rounds. There can be only one of each, split equally into two entries.\nThe parameters of the lock and vesting stakes are: "),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"lastWithdrawalTime"),": last time a withdrawal period ended and a part of the stake was unlocked (in unixtime). "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"owner"),": the address that made the lock or vesting stake on behalf of the participant. "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"remainingAmount"),": the current amount staked in this round (in nanoevers)."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"withdrawalPeriod"),": the period in seconds, after which the next part of the stake gets unlocked. "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"withdrawalValue"),": the value that is unlocked every withdrawal period (in nanoevers).\n",(0,l.kt)("inlineCode",{parentName:"li"},"lockDonor")," and ",(0,l.kt)("inlineCode",{parentName:"li"},"vestingDonor")," are the addresses set by the participant to be their ",(0,l.kt)("a",{parentName:"li",href:"#3-lock-stake"},"lock")," and ",(0,l.kt)("a",{parentName:"li",href:"#2-vesting-stake"},"vesting")," donors, respectively.")),(0,l.kt)("h5",{id:"getdepoolinfo"},(0,l.kt)("inlineCode",{parentName:"h5"},"getDePoolInfo()")),(0,l.kt)("p",null,"Returns DePool configuration parameters and constants (supplementary contract addresses, minimal stake settings and fees for various actions)."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli run <depool_address> getDePoolInfo {} --abi DePool.abi.json\n")),(0,l.kt)("p",null,"Where\n",(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract.\nOutput example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'Result: {\n  "poolClosed": false,\n  "minStake": "10000000000",\n  "validatorAssurance": "100000000000000",\n  "participantRewardFraction": "50",\n  "validatorRewardFraction": "50",\n  "balanceThreshold": "15858929993",\n  "validatorWallet": "0:303c1aa8110dc5c543687c6bba699add7a7faf2ed55737f494f78d1c51c6b8d4",\n  "proxies": [\n    "-1:1ef217ee3f9aa5cd2202919c97e1b61caddcb1a80f450d82990a06b918a75d82",\n    "-1:d16999c37c82523d1931011471967ae9e06ee53c1cafcacc8f6d3bee34f15044"\n  ],\n  "stakeFee": "500000000",\n  "retOrReinvFee": "40000000",\n  "proxyFee": "90000000"\n}\n')),(0,l.kt)("p",null,"The round parameters displayed by the get-method are the following:\n",(0,l.kt)("inlineCode",{parentName:"p"},"poolClosed"),": whether DePool was ",(0,l.kt)("a",{parentName:"p",href:"#14-optional-close-depool"},"closed"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"minStake"),": the minimal stake the DePool accepts from participants (in nanoevers). Set during ",(0,l.kt)("a",{parentName:"p",href:"#61-deploy-depool-contract-to-the-basechain"},"deployment"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"validatorAssurance"),": required validator stake (in nanoevers). Also set during ",(0,l.kt)("a",{parentName:"p",href:"#61-deploy-depool-contract-to-the-basechain"},"deployment"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"participantRewardFraction"),": percentage of the reward that goes to all participants. Also set during ",(0,l.kt)("a",{parentName:"p",href:"#61-deploy-depool-contract-to-the-basechain"},"deployment"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"validatorRewardFraction"),": the fraction of the total reward that goes directly to validator. Equals 100% - ",(0,l.kt)("inlineCode",{parentName:"p"},"participantRewardFraction"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"validatorWallet"),": the address of the validator wallet. Also set during ",(0,l.kt)("a",{parentName:"p",href:"#61-deploy-depool-contract-to-the-basechain"},"deployment"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"proxies"),": the two proxies on the masterchain that DePool uses to communicate with elector. They are deployed by the DePool itself.\n",(0,l.kt)("inlineCode",{parentName:"p"},"stakeFee"),": fee for ",(0,l.kt)("a",{parentName:"p",href:"#8-make-stakes"},"staking operations")," (in nanoevers).\n",(0,l.kt)("inlineCode",{parentName:"p"},"retOrReinvFee"),": the fee deducted from every participant's stake and rewards during reward distribution at the end of the round (in nanoevers).\n",(0,l.kt)("inlineCode",{parentName:"p"},"proxyFee"),": the fee that proxies take for any messages passed through them (in nanoevers). "),(0,l.kt)("h5",{id:"getrounds"},(0,l.kt)("inlineCode",{parentName:"h5"},"getRounds()")),(0,l.kt)("p",null,"Returns information about all rounds (step, total stake, stakeholder count, round id)."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli run <depool_address> getRounds {} --abi DePool.abi.json\n")),(0,l.kt)("p",null,"Where\n",(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract.\nOutput example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'Result: {\n  "rounds": {\n    "159": {\n      "id": "159",\n      "supposedElectedAt": "1611664334",\n      "unfreeze": "0",\n      "stakeHeldFor": "900",\n      "vsetHashInElectionPhase": "0xc09caf4efff6cabff6185754d2150bc11d94098f97ea146a617e9d0d90cecc76",\n      "step": "9",\n      "completionReason": "3",\n      "stake": "2525331200749",\n      "recoveredStake": "0",\n      "unused": "0",\n      "isValidatorStakeCompleted": true,\n      "rewards": "0",\n      "participantQty": "0",\n      "validatorStake": "2525331200749",\n      "validatorRemainingStake": "0",\n      "handledStakesAndRewards": "2525331200749"\n    },\n    "161": {\n      "id": "161",\n      "supposedElectedAt": "0",\n      "unfreeze": "4294967295",\n      "stakeHeldFor": "0",\n      "vsetHashInElectionPhase": "0x0000000000000000000000000000000000000000000000000000000000000000",\n      "step": "1",\n      "completionReason": "0",\n      "stake": "2525331200749",\n      "recoveredStake": "0",\n      "unused": "0",\n      "isValidatorStakeCompleted": false,\n      "rewards": "0",\n      "participantQty": "1",\n      "validatorStake": "0",\n      "validatorRemainingStake": "0",\n      "handledStakesAndRewards": "0"\n    },\n    "160": {\n      "id": "160",\n      "supposedElectedAt": "1611666134",\n      "unfreeze": "4294967295",\n      "stakeHeldFor": "900",\n      "vsetHashInElectionPhase": "0x7965b01da2b778404bd5b9e6dc5a5f6d1e4ce15a78284ebec78ed86a8852d5f9",\n      "step": "6",\n      "completionReason": "0",\n      "stake": "205352016359392",\n      "recoveredStake": "0",\n      "unused": "0",\n      "isValidatorStakeCompleted": false,\n      "rewards": "0",\n      "participantQty": "2",\n      "validatorStake": "104517866677409",\n      "validatorRemainingStake": "0",\n      "handledStakesAndRewards": "0"\n    },\n    "162": {\n      "id": "162",\n      "supposedElectedAt": "0",\n      "unfreeze": "4294967295",\n      "stakeHeldFor": "0",\n      "vsetHashInElectionPhase": "0x0000000000000000000000000000000000000000000000000000000000000000",\n      "step": "0",\n      "completionReason": "0",\n      "stake": "0",\n      "recoveredStake": "0",\n      "unused": "0",\n      "isValidatorStakeCompleted": false,\n      "rewards": "0",\n      "participantQty": "0",\n      "validatorStake": "0",\n      "validatorRemainingStake": "0",\n      "handledStakesAndRewards": "0"\n    }\n  }\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"id"),": round ID. It's also displayed above each round. At DePool deployment, the first four rounds are created: 0, 1, 2 and 3. Whenever one round completes and is removed from the DePool, a new one is created, its ID incremented by 1: when 0 is removed, 4 is created, etc.\n",(0,l.kt)("inlineCode",{parentName:"p"},"supposedElectedAt"),":  the time the validator is scheduled to start validating, if elected (in unixtime). This value remains 0, until validator elections start and DePool enters waitingValidatorRequest step of the round. Then it is set to the time the election winners will start validating.\n",(0,l.kt)("inlineCode",{parentName:"p"},"unfreeze"),": the time the stake will be unfrozen by elector (in unixtime). This value remains 4294967295 until validation ends.\n",(0,l.kt)("inlineCode",{parentName:"p"},"stakeHeldFor"),": the period in seconds for which stake will remain frozen in elector after validation. It's set by the global configuration parameter p15 when validation completes.\n",(0,l.kt)("inlineCode",{parentName:"p"},"vsetHashInElectionPhase"),": this is a system variable that holds the hash of validation set (global config parameter 34) when round was in election phase. Is set during election.\n",(0,l.kt)("inlineCode",{parentName:"p"},"step"),": step the round is currently at. The possible steps are:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"0")," - ",(0,l.kt)("strong",{parentName:"li"},"PrePooling"),": step reserved for receiving half of   ",(0,l.kt)("a",{parentName:"li",href:"#2-vesting-stake"},"vesting"),"/",(0,l.kt)("a",{parentName:"li",href:"#3-lock-stake"},"lock")," stake from participants. Nothing else happens when round is in this step."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"1")," - ",(0,l.kt)("strong",{parentName:"li"},"Pooling"),": DePool receives stakes from participants. Half of   ",(0,l.kt)("a",{parentName:"li",href:"#2-vesting-stake"},"vesting"),"/",(0,l.kt)("a",{parentName:"li",href:"#3-lock-stake"},"lock")," stakes are invested into the round in the pooling step, the other into the round in the PrePooling step. This way, the other half of these stakes is always invested into the very next round."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"2")," - ",(0,l.kt)("strong",{parentName:"li"},"WaitingValidatorRequest"),": waiting for ",(0,l.kt)("a",{parentName:"li",href:"#10-set-up-validator-script"},"election request")," from validator. The elections have begun, it's no longer possible to invest stakes into this round. Once election request from validator is received, DePool can participate in elections."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"3")," - ",(0,l.kt)("strong",{parentName:"li"},"WaitingIfStakeAccepted"),": stake has been sent to elector. Waiting for answer from elector."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"4")," - ",(0,l.kt)("strong",{parentName:"li"},"WaitingValidationStart"),": elector has accepted round stake. Validator is candidate. Waiting for validation to start, to know if validator won elections."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"5")," - ",(0,l.kt)("strong",{parentName:"li"},"WaitingIfValidatorWinElections"),": DePool has tried to recover stake in validation period to know if validator won elections. Waiting for elector answer."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"6")," - ",(0,l.kt)("strong",{parentName:"li"},"WaitingUnfreeze"),": DePool received elector answer and waits for the end of unfreeze period. If at this step CompletionReason!=0, then validator did not win and DePool is waiting to return/reinvest funds after the next round. Else validator won elections."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"7")," - ",(0,l.kt)("strong",{parentName:"li"},"WaitingReward"),": Unfreeze period has been ended. Request to recover stake has been sent to elector. Waiting for answer from elector."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"8")," - ",(0,l.kt)("strong",{parentName:"li"},"Completing"),": Returning or reinvesting participant stakes because round is completed."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"9")," - ",(0,l.kt)("strong",{parentName:"li"},"Completed"),": All stakes of the round have been returned or reinvested. At the next round rotation the round will be deleted from the DePool.\n",(0,l.kt)("inlineCode",{parentName:"li"},"completionReason"),': the code for the reason the round was completed. Remains "0", until round actually is completed. The possible reasons are:\n'),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"0")," - Round is not completed yet."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"1")," - Pool was ",(0,l.kt)("a",{parentName:"li",href:"#14-optional-close-depool"},"closed")," by owner."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"2")," - The round was one of the first two rounds after deployment: 0 or 1. These first rounds are empty and are used only to launch the round rotation mechanism. They complete with this code without performing any additional actions."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"3")," - Validator stake is less than ",(0,l.kt)("a",{parentName:"li",href:"#61-deploy-depool-contract-to-the-basechain"},"validatorAssurance"),"."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"4")," - Stake is rejected by elector for some reason."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"5")," - Round is completed successfully. DePool won elections, its node performed validation and it received the reward from elector."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"6")," - DePool has participated in elections but lost the elections."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"7")," - Validator is blamed during investigation phase."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("strong",{parentName:"li"},"8")," - Validator sent no ",(0,l.kt)("a",{parentName:"li",href:"#10-set-up-validator-script"},"request")," during election phase.\n",(0,l.kt)("inlineCode",{parentName:"li"},"stake"),": the total stake in the current round, that is sent to elector (in nanoevers).\n",(0,l.kt)("inlineCode",{parentName:"li"},"recoveredStake"),": the total stake returned by elector (in nanoevers).\n",(0,l.kt)("inlineCode",{parentName:"li"},"unused"),": if the stake was cut off by the elector (this can happen if there is a significant number of election candidates with much smaller stakes), this value equals the amount cut off (in nanoevers). This amount is not lost to participants - it simply isn't staked in this round and the rewards for the round will be proportionally smaller. If DePool did not receive a ticktock call during the validation period, this value will remain 0, even if some funds were cut off.\n",(0,l.kt)("inlineCode",{parentName:"li"},"isValidatorStakeCompleted"),": indicates whether validator's stake has been processed during Completing round step. Whenever participants receive rewards, validator's stake should be processed first, as any losses the total stake sustains due to poor node rerformance are first deducted from validator's share of the pool.\n",(0,l.kt)("inlineCode",{parentName:"li"},"rewards"),": the total rewards that are distributed among all participants in the current round (in nanoevers). Is calculated when the stake is returned from elector.\n",(0,l.kt)("inlineCode",{parentName:"li"},"participantQty"),": the quantity of participants in the round.\n",(0,l.kt)("inlineCode",{parentName:"li"},"validatorStake"),": this value equals the final validator stake in the current round. It is set at the and of the Pooling step.\n",(0,l.kt)("inlineCode",{parentName:"li"},"validatorRemainingStake"),": this value is used if validator got punished by elector for poor node performance and part of the DePool stake is lost. Then this value equals the remaining validator stake, if any (in nanoevers).\n",(0,l.kt)("inlineCode",{parentName:"li"},"handledStakesAndRewards"),": the total quantity of stakes and rewards that were processed by the DePool during Completing step (in nanoevers).")),(0,l.kt)("h4",{id:"getparticipants"},(0,l.kt)("inlineCode",{parentName:"h4"},"getParticipants()")),(0,l.kt)("p",null,"Returns list of all participants."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli run <depool_address> getParticipants {} --abi DePool.abi.json\n")),(0,l.kt)("p",null,"Where\n",(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract.\nOutput example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'Result: {\n  "participants": [\n    "0:9fa316f41fe4e991865b80006c9d9916b2637146e9a6f346eeb25c035206c5b7",\n    "0:a08bb1f6c64939bcbd3d950a44d88820f0102c550bfaf49f70f2d012eeec333a",\n    "-1:68384476fce1d2649484912c08541a8037c36b606aca0f8cc04c043640e8dd98"\n  ]\n}\n')),(0,l.kt)("h4",{id:"getdepoolbalance"},(0,l.kt)("inlineCode",{parentName:"h4"},"getDePoolBalance()")),(0,l.kt)("p",null,"Returns DePool's own ",(0,l.kt)("a",{parentName:"p",href:"#depool-balance"},"balance")," in nanotokens (without stakes)."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli run <depool_address> getDePoolBalance {} --abi DePool.abi.json\n")),(0,l.kt)("p",null,"Where\n",(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool contract."),(0,l.kt)("h3",{id:"13-optional-adjust-validator-and-participant-reward-fraction"},"13. (Optional) Adjust validator and participant reward fraction"),(0,l.kt)("p",null,"If you want to make your DePool more attractive to potential participants, you may increase the fraction of the total reward they receive.\nDePool ",(0,l.kt)("a",{parentName:"p",href:"#61-deploy-depool-contract-to-the-basechain"},"deployment keys")," are required for this action. Use the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli call <depool_address> setValidatorRewardFraction '{\"fraction\":<fraction_value>}' --abi DePool.abi.json --sign <depool_keyfile_or_seed_phrase>\n")),(0,l.kt)("p",null,"Where\n",(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool.\n",(0,l.kt)("inlineCode",{parentName:"p"},"<fraction_value>")," - new value of Validators reward fraction, which should be less than previous and should not be equal to 0.\n",(0,l.kt)("inlineCode",{parentName:"p"},"<depool_keyfile_or_seed_phrase>")," - DePool ",(0,l.kt)("a",{parentName:"p",href:"#61-deploy-depool-contract-to-the-basechain"},"deployment keyfile or its corresponding seed phrase"),".\nExample:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli call 0:53acdc8033cc0794125038a810d4b64e24e72add52ee866b82ade42d12cd9f02 setValidatorRewardFraction '{\"fraction\":29}' --abi DePool.abi.json --sign depool.keys.json\n")),(0,l.kt)("p",null,"Current validator reward fraction value can be viewed with the ",(0,l.kt)("inlineCode",{parentName:"p"},"getDePoolInfo")," ",(0,l.kt)("a",{parentName:"p",href:"#getdepoolinfo"},"get-method"),"."),(0,l.kt)("h3",{id:"14-optional-close-depool"},"14. (Optional) Close DePool"),(0,l.kt)("p",null,"The deployer of the DePool can close the DePool at any time. DePool ",(0,l.kt)("a",{parentName:"p",href:"#61-deploy-depool-contract-to-the-basechain"},"deployment keys")," are required for this action:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli call <depool_address> terminator {} --abi DePool.abi.json --sign <depool_keyfile_or_seed_phrase>\n")),(0,l.kt)("p",null,"Where\n",(0,l.kt)("inlineCode",{parentName:"p"},"<depool_address>")," - address of the DePool.\n",(0,l.kt)("inlineCode",{parentName:"p"},"<depool_keyfile_or_seed_phrase>")," - DePool ",(0,l.kt)("a",{parentName:"p",href:"#61-deploy-depool-contract-to-the-basechain"},"deployment keyfile or its corresponding seed phrase"),".\nExample:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli call 0:37fbcb6e3279cbf5f783d61c213ed20fee16e0b1b94a48372d20a2596b700ace terminator {} --abi DePool.abi.json --sign depool.json\n")),(0,l.kt)("p",null,"When a DePool is closed, all the stakes invested in it are returned to their owners, as soon as they become available. ",(0,l.kt)("inlineCode",{parentName:"p"},"dePoolClosed")," event is emitted. The closed DePool cannot be reactivated again.\nTo return all stakes currently locked in rounds to their owners, make sure DePool's ",(0,l.kt)("a",{parentName:"p",href:"#7-configure-depool-state-update-method"},"state update function")," is called once the current and the next validation cycles complete."),(0,l.kt)("h2",{id:"rewards-distribution"},"Rewards Distribution"),(0,l.kt)("p",null,"Every time DePool receives rewards for validation, DePool replenishes it's own balance and  the rest is distributed according to the following rules:\n1) ",(0,l.kt)("inlineCode",{parentName:"p"},"validatorRewardFraction"),"% of the reward, regardless of the validator\u2019s share in the pool, goes directly to the validator wallet. This is the reward for maintaining the node and is intended to be used on operational expenses.\n2) ",(0,l.kt)("inlineCode",{parentName:"p"},"participantRewardFraction"),"% of the reward is distributed among all participants (including the validator) proportionally to their share of the staking pool. By default these rewards are added to the ordinary stakes of all participants and reinvested with it. To withdraw this stake or any part of it to the participant wallet, use one of the withdrawal functions."),(0,l.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,l.kt)("h3",{id:"1-wrong-contract-version"},"1. Wrong contract version"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Issue"),": Wrong/outdated version of any contracts involved in DePool operations may cause various issues and hard-to-diagnose behavior.\nTo check contract versions, search for the addresses of DePool, DePool Helper and both proxies on ",(0,l.kt)("a",{parentName:"p",href:"http://ever.live"},"ever.live")," and review ",(0,l.kt)("strong",{parentName:"p"},"Code hash")," (may be hidden under ",(0,l.kt)("strong",{parentName:"p"},"More details"),"). Click on the value to copy it to clipboard.\nIt should match the following values:\nDePool:\n",(0,l.kt)("inlineCode",{parentName:"p"},"14e20e304f53e6da152eb95fffc993dbd28245a775d847eed043f7c78a503885"),"\nProxies:\n",(0,l.kt)("inlineCode",{parentName:"p"},"c05938cde3cee21141caacc9e88d3b8f2a4a4bc3968cb3d455d83cd0498d4375"),"\nDePool Helper:\n",(0,l.kt)("inlineCode",{parentName:"p"},"f990434c02c2b532087782a2d615292c7c241ece4a9af33f8d090c535296401d"),"\nIf only the Helper contract has wrong Code hash, deploying and configuring only a new Helper is enough.\nIf DePool or proxies have wrong Code hash, all contracts have to be redeployed, and the node reconfigured to work with the new DePool."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"Note"),": For RustCup, contract code hash is different."),(0,l.kt)("p",{parentName:"blockquote"}," Initially the following contracts were used:"),(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("inlineCode",{parentName:"p"},"891d1afd26d99ee4f9def21fbd4bccffe25143e79729669573c7d792a646f4e9")," for DePool"),(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("inlineCode",{parentName:"p"},"d938d7c19af7ba65342e6fc2f4c6827b7e16ce378722ce134bb461f9d62f6c76")," for proxy"),(0,l.kt)("p",{parentName:"blockquote"},"After the August 5 update the code hashes are as follows:"),(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("inlineCode",{parentName:"p"},"cef9fe9fed144e25e24aa671da1118244dfb2d1e316e9961522cd9b015bbba59")," for DePool"),(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("inlineCode",{parentName:"p"},"b633f0b5bc420abd8cb74b03eb0960df2a91c6c123d5cb18ed7283bb26e491bd")," for proxy")),(0,l.kt)("h3",{id:"2-depool-isnt-emitting-events"},"2. DePool isn't emitting events"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Issue"),": DePool seems to be set up correctly, but is not emitting expected ",(0,l.kt)("a",{parentName:"p",href:"#using-depool-events"},"events"),", for example ",(0,l.kt)("inlineCode",{parentName:"p"},"stakeSigningRequested"),".\nThis can be caused by issues with the state update method.\n",(0,l.kt)("strong",{parentName:"p"},"Possible solutions:")),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Change the global timer and/or the timer call period (termporarily unavailable):",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli call <HelperAddress> initTimer \'{"timer":"TimerAddress","period":*number*}\' --abi DePoolHelper.abi.json --sign helper.json\n')),"Where\n",(0,l.kt)("inlineCode",{parentName:"li"},"<HelperAddress>")," \u2013 is the address of the Helper contract from step 4.2\n",(0,l.kt)("inlineCode",{parentName:"li"},"<TimerAddress>")," - is the address of the global timer contract.\n",(0,l.kt)("inlineCode",{parentName:"li"},'"period":*number*')," - is the period for regular DePool contract calls via ticktock messages (in seconds)."),(0,l.kt)("li",{parentName:"ol"},"Set up external ticktock function call through TONOS-CLI:",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli call <HelperAddress> sendTicktock {} --abi DePoolHelper.abi.json --sign helper.json\n")),"Where\n",(0,l.kt)("inlineCode",{parentName:"li"},"<HelperAddress>")," \u2013 is the address of the Helper contract from step 4.2.\nIf necessary, run it regularly, e.g. with cron:",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"@hourly        cd <tonos-cli-dir> && tonos-cli call <HelperAddress> sendTicktock {} --abi DePoolHelper.abi.json --sign helper.json\n")),"Where\n",(0,l.kt)("inlineCode",{parentName:"li"},"<tonos-cli-dir>")," - directory with TONOS-CLI configuration file, ",(0,l.kt)("inlineCode",{parentName:"li"},"DePoolHelper.abi.json")," file and ",(0,l.kt)("inlineCode",{parentName:"li"},"helper.json")," keyfile containing DePool Helper keys.\n",(0,l.kt)("inlineCode",{parentName:"li"},"<HelperAddress>")," \u2013 is the address of the Helper contract from step 4.2."),(0,l.kt)("li",{parentName:"ol"},"Call DePool's ticktock function through multisig instead of Helper:",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"tonos-cli depool [--addr <depool_address>] ticktock [-w <msig_address>] [-s <path_to_keys_or_seed_phrase>]\n")),"Where\n",(0,l.kt)("inlineCode",{parentName:"li"},"--addr <depool_address>")," - the address of the DePool\n",(0,l.kt)("inlineCode",{parentName:"li"},"-w <msig_address>")," - the address of the multisig wallet used to call DePool\n",(0,l.kt)("inlineCode",{parentName:"li"},"-s <path_to_keys_or_seed_phrase>")," - either the keyfile for the wallet making the stake, or the seed phrase in quotes\nAll these options can be skipped, if they were previously specified in the TONOS-CLI configuration file.\n1 token is always attached to this call, change is returned to sender.")),(0,l.kt)("h3",{id:"3-validator-script-and-election-request-issues"},"3. Validator script and election request issues"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Issue"),": DePool isn't receiving election request from validator script and/or isn't passing it on to the Elector.\nThis can be caused by DePool setup errors, low balance on some of the contracts involved, or issues with the script or node setup.\n",(0,l.kt)("strong",{parentName:"p"},"Possible solutions and diagnostic methods"),":"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"If the DePool fails to accumulate a suitable stake, or malfunctions in any other manner, the election request will not pass through to the Elector. Always make sure that the full DePool setup procedure described in this document is completed, and that DePool contract itself operates correctly, i.e. enters waiting request step and emits ",(0,l.kt)("inlineCode",{parentName:"li"},"stakeSigningRequested")," ",(0,l.kt)("a",{parentName:"li",href:"#using-depool-events"},"event"),", when encountering problems with election participation."),(0,l.kt)("li",{parentName:"ol"},"Check balance of all contracts and top up if any of them have run out of funds (see ",(0,l.kt)("a",{parentName:"li",href:"#11-maintain-positive-balance-on-depool-and-supplementary-contracts"},"section 11")," for details).")),(0,l.kt)("h4",{id:"for-c-node-1"},"For C++ Node"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Check that the DePool address is specified in the in the ",(0,l.kt)("inlineCode",{parentName:"li"},"~/ton-keys/depool.addr")," file in your validator node files and matches your current DePool address."),(0,l.kt)("li",{parentName:"ol"},"Check that the validator wallet address is specified in the ",(0,l.kt)("inlineCode",{parentName:"li"},"~/ton-keys/$(hostname -s).addr")," file according to the ",(0,l.kt)("a",{parentName:"li",href:"https://docs.ton.dev/86757ecb2/p/708260-run-validator/t/906cb8"},"node setup procedure"),"."),(0,l.kt)("li",{parentName:"ol"},"Check that the validator wallet keys are saved to the ",(0,l.kt)("inlineCode",{parentName:"li"},"~/ton-keys/msig.keys.json")," file according to the ",(0,l.kt)("a",{parentName:"li",href:"https://docs.ton.dev/86757ecb2/p/708260-run-validator/t/05caf5"},"node setup procedure"),"."),(0,l.kt)("li",{parentName:"ol"},"Check validator script output log (",(0,l.kt)("inlineCode",{parentName:"li"},"/var/ton-work/validator_depool.log")," file if script is set up according to the given example). They may help identify the cause of the issue."),(0,l.kt)("li",{parentName:"ol"},"Rerun the command to send election request manually. It can be found in the validator script output log (",(0,l.kt)("inlineCode",{parentName:"li"},"/var/ton-work/validator_depool.log")," file if set up according to the given example) and used as is.\nExample:",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'tonos-cli call -1:fd05bd9be4e2d3ee7789d1fbc5811e0bd85cf1d14968028fd46a9e1c7b1066cc submitTransaction \'{"dest":"0:10fdf438953430949ca33147f792b9fd9002e7979e50c94547c771c51fb643b9","value":"1000000000","bounce":true,"allBalance":false,"payload":"te6cckEBAgEAmQABqE5zdEsAAAAAXz7BoZOzdxrAyZXWwptpyrV5ZV1EkLrRdSsfm0KFiFpOuB4XXz7FVAADAACIUt3MiEtCLfPfKEWoVz2sTA9yS/Sl8N88ZkQ8CB1c3QEAgNnX/KhAEKVKe/MO4ArCIMLXM1kgYu34Ujp9dSq2lkSo8vfj0s+yySs6Ac2ufavtXO4DLZ1afugAVwUjvKvI3Agoizgf"}\' --abi /validation/configs/SafeMultisigWallet.abi.json --sign /keys/msig.keys.json\n'))),(0,l.kt)("li",{parentName:"ol"},"Run validator script with verbose logs to get more diagnostic information:",(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"bash -x ./validator_depool.sh\n")))),(0,l.kt)("h4",{id:"for-rust-node-1"},"For Rust Node"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Check that the DePool address is specified in the in the ",(0,l.kt)("inlineCode",{parentName:"li"},"/ton-node/configs/depool.addr")," file in your validator node files and matches your current DePool address."),(0,l.kt)("li",{parentName:"ol"},"Check that the validator wallet address is specified in the ",(0,l.kt)("inlineCode",{parentName:"li"},"/ton-node/configs/${VALIDATOR_NAME}.addr")," file"),(0,l.kt)("li",{parentName:"ol"},"Check that the validator wallet keys are saved to the ",(0,l.kt)("inlineCode",{parentName:"li"},"/ton-node/configs/keys/msig.keys.json")," file"),(0,l.kt)("li",{parentName:"ol"},"Refer to ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/tonlabs/rustnet.ton.dev#troubleshooting"},"this document")," for Rust node troubleshooting.")),(0,l.kt)("h3",{id:"4-depool-function-terminates-with-error-in-tonos-cli"},"4. DePool function terminates with error in TONOS-CLI"),(0,l.kt)("p",null,"In TONOS-CLI output it looks like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'message: Contract execution was terminated with error\nmessage_processing_state: null\ndata: {\n  "account_address": "0:3187b4d738d69776948ca8543cb7d250c042d7aad1e0aa244d247531590b9147",\n  "config_server": "net.ton.dev",\n  "exit_code": 140,\n  "function_name": "constructor",\n  "original_error": {\n    "code": 1006,\n    "core_version": "0.27.0",\n    "data": {\n      "block_id": "20c8932bc6c7baa90c2d099595b432607355b79d95293061dc6feec392675975",\n      "block_time": "Thu, 19 Nov 2020 13:24:37 +0300 (1605781477)",\n      "expiration_time": "Thu, 19 Nov 2020 13:24:35 +0300 (1605781475)",\n      "message_id": "eae70ebcf84fd9ebcffc544908ca637d9a46a8bdffdab24db6749d003608969e",\n      "sending_time": "Thu, 19 Nov 2020 13:23:35 +0300 (1605781415)"\n    },\n    "message": "Message was not delivered within the specified timeout",\n    "message_processing_state": null,\n    "source": "node"\n  },\n')),(0,l.kt)("p",null,"The error code is indicated in the ",(0,l.kt)("inlineCode",{parentName:"p"},'"exit_code"')," line.\nPossible error codes and their meanings:\n",(0,l.kt)("inlineCode",{parentName:"p"},"101")," - message sender is not owner (message public key is wrong). Please check your key file or seed phrase.\n",(0,l.kt)("inlineCode",{parentName:"p"},"108")," - function cannot be called by external message.\n",(0,l.kt)("inlineCode",{parentName:"p"},"113")," - message sender is not validator wallet.\n",(0,l.kt)("inlineCode",{parentName:"p"},"114")," - DePool is ",(0,l.kt)("a",{parentName:"p",href:"#14-optional-close-depool"},"closed"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"116")," - participant with such address does not exist.\n",(0,l.kt)("inlineCode",{parentName:"p"},"129")," - incorrectly defined stake parameters during DePool deployment (",(0,l.kt)("inlineCode",{parentName:"p"},"minStake")," < 1 token or ",(0,l.kt)("inlineCode",{parentName:"p"},"minStake")," > ",(0,l.kt)("inlineCode",{parentName:"p"},"validatorAssurance"),"). Please check your parameters in ",(0,l.kt)("a",{parentName:"p",href:"#61-deploy-depool-contract-to-the-basechain"},"deploy message"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"130")," - DePool deployment isn't signed with public key. Please check your key file or seed phrase.\n",(0,l.kt)("inlineCode",{parentName:"p"},"133")," - validator address passed to constructor is not of add_std type. Please check your parameters in ",(0,l.kt)("a",{parentName:"p",href:"#61-deploy-depool-contract-to-the-basechain"},"deploy message"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"138")," - Incorrect participant reward fraction during DePool deployment (",(0,l.kt)("inlineCode",{parentName:"p"},"participantRewardFraction")," \u2264 0 or  \u2265 100). Please check your parameters in ",(0,l.kt)("a",{parentName:"p",href:"#61-deploy-depool-contract-to-the-basechain"},"deploy message"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"141")," - incorrectly specified proxy code during DePool deployment. Please check your parameters in ",(0,l.kt)("a",{parentName:"p",href:"#61-deploy-depool-contract-to-the-basechain"},"deploy message"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"142")," - DePool is being deployed to the wrong shardchain (workchain id \u2260 0). Please check your parameters in ",(0,l.kt)("a",{parentName:"p",href:"#61-deploy-depool-contract-to-the-basechain"},"deploy message"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"143")," - new validator reward fraction is greater than old.\n",(0,l.kt)("inlineCode",{parentName:"p"},"144")," - new validator reward fraction is zero.\n",(0,l.kt)("inlineCode",{parentName:"p"},"146")," - insufficient ",(0,l.kt)("a",{parentName:"p",href:"#depool-balance"},"DePool balance"),".\n",(0,l.kt)("inlineCode",{parentName:"p"},"147")," - validator wallet address is zero.\n",(0,l.kt)("inlineCode",{parentName:"p"},"149")," - incorrectly specified minimal stake and validator assurance.\nIncorrect DePool function call by another contract:\n",(0,l.kt)("inlineCode",{parentName:"p"},"107")," - message sender is not proxy contract.\n",(0,l.kt)("inlineCode",{parentName:"p"},"120")," - message sender is not DePool (this is not a self call).\n",(0,l.kt)("inlineCode",{parentName:"p"},"125")," - invalid confirmation from elector (invalid round step).\n",(0,l.kt)("inlineCode",{parentName:"p"},"126")," - invalid confirmation from elector (invalid query ID).\n",(0,l.kt)("inlineCode",{parentName:"p"},"127")," - invalid confirmation from elector (sender is not elector).\n",(0,l.kt)("inlineCode",{parentName:"p"},"148")," - message sender is not one of the proxies."))}u.isMDXComponent=!0}}]);